\documentclass[11pt]{article}

    \usepackage[breakable]{tcolorbox}
    \usepackage{parskip} % Stop auto-indenting (to mimic markdown behaviour)
    
    \usepackage{iftex}
    \ifPDFTeX
    	\usepackage[T1]{fontenc}
    	\usepackage{mathpazo}
    \else
    	\usepackage{fontspec}
    \fi

    % Basic figure setup, for now with no caption control since it's done
    % automatically by Pandoc (which extracts ![](path) syntax from Markdown).
    \usepackage{graphicx}
    % Maintain compatibility with old templates. Remove in nbconvert 6.0
    \let\Oldincludegraphics\includegraphics
    % Ensure that by default, figures have no caption (until we provide a
    % proper Figure object with a Caption API and a way to capture that
    % in the conversion process - todo).
    \usepackage{caption}
    \DeclareCaptionFormat{nocaption}{}
    \captionsetup{format=nocaption,aboveskip=0pt,belowskip=0pt}

    \usepackage{float}
    \floatplacement{figure}{H} % forces figures to be placed at the correct location
    \usepackage{xcolor} % Allow colors to be defined
    \usepackage{enumerate} % Needed for markdown enumerations to work
    \usepackage{geometry} % Used to adjust the document margins
    \usepackage{amsmath} % Equations
    \usepackage{amssymb} % Equations
    \usepackage{textcomp} % defines textquotesingle
    % Hack from http://tex.stackexchange.com/a/47451/13684:
    \AtBeginDocument{%
        \def\PYZsq{\textquotesingle}% Upright quotes in Pygmentized code
    }
    \usepackage{upquote} % Upright quotes for verbatim code
    \usepackage{eurosym} % defines \euro
    \usepackage[mathletters]{ucs} % Extended unicode (utf-8) support
    \usepackage{fancyvrb} % verbatim replacement that allows latex
    \usepackage{grffile} % extends the file name processing of package graphics 
                         % to support a larger range
    \makeatletter % fix for old versions of grffile with XeLaTeX
    \@ifpackagelater{grffile}{2019/11/01}
    {
      % Do nothing on new versions
    }
    {
      \def\Gread@@xetex#1{%
        \IfFileExists{"\Gin@base".bb}%
        {\Gread@eps{\Gin@base.bb}}%
        {\Gread@@xetex@aux#1}%
      }
    }
    \makeatother
    \usepackage[Export]{adjustbox} % Used to constrain images to a maximum size
    \adjustboxset{max size={0.9\linewidth}{0.9\paperheight}}

    % The hyperref package gives us a pdf with properly built
    % internal navigation ('pdf bookmarks' for the table of contents,
    % internal cross-reference links, web links for URLs, etc.)
    \usepackage{hyperref}
    % The default LaTeX title has an obnoxious amount of whitespace. By default,
    % titling removes some of it. It also provides customization options.
    \usepackage{titling}
    \usepackage{longtable} % longtable support required by pandoc >1.10
    \usepackage{booktabs}  % table support for pandoc > 1.12.2
    \usepackage[inline]{enumitem} % IRkernel/repr support (it uses the enumerate* environment)
    \usepackage[normalem]{ulem} % ulem is needed to support strikethroughs (\sout)
                                % normalem makes italics be italics, not underlines
    \usepackage{mathrsfs}
    

    
    % Colors for the hyperref package
    \definecolor{urlcolor}{rgb}{0,.145,.698}
    \definecolor{linkcolor}{rgb}{.71,0.21,0.01}
    \definecolor{citecolor}{rgb}{.12,.54,.11}

    % ANSI colors
    \definecolor{ansi-black}{HTML}{3E424D}
    \definecolor{ansi-black-intense}{HTML}{282C36}
    \definecolor{ansi-red}{HTML}{E75C58}
    \definecolor{ansi-red-intense}{HTML}{B22B31}
    \definecolor{ansi-green}{HTML}{00A250}
    \definecolor{ansi-green-intense}{HTML}{007427}
    \definecolor{ansi-yellow}{HTML}{DDB62B}
    \definecolor{ansi-yellow-intense}{HTML}{B27D12}
    \definecolor{ansi-blue}{HTML}{208FFB}
    \definecolor{ansi-blue-intense}{HTML}{0065CA}
    \definecolor{ansi-magenta}{HTML}{D160C4}
    \definecolor{ansi-magenta-intense}{HTML}{A03196}
    \definecolor{ansi-cyan}{HTML}{60C6C8}
    \definecolor{ansi-cyan-intense}{HTML}{258F8F}
    \definecolor{ansi-white}{HTML}{C5C1B4}
    \definecolor{ansi-white-intense}{HTML}{A1A6B2}
    \definecolor{ansi-default-inverse-fg}{HTML}{FFFFFF}
    \definecolor{ansi-default-inverse-bg}{HTML}{000000}

    % common color for the border for error outputs.
    \definecolor{outerrorbackground}{HTML}{FFDFDF}

    % commands and environments needed by pandoc snippets
    % extracted from the output of `pandoc -s`
    \providecommand{\tightlist}{%
      \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
    \DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
    % Add ',fontsize=\small' for more characters per line
    \newenvironment{Shaded}{}{}
    \newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{{#1}}}
    \newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{{#1}}}}
    \newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{{#1}}}
    \newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{{#1}}}
    \newcommand{\RegionMarkerTok}[1]{{#1}}
    \newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\NormalTok}[1]{{#1}}
    
    % Additional commands for more recent versions of Pandoc
    \newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.53,0.00,0.00}{{#1}}}
    \newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.73,0.40,0.53}{{#1}}}
    \newcommand{\ImportTok}[1]{{#1}}
    \newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.73,0.13,0.13}{\textit{{#1}}}}
    \newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\VariableTok}[1]{\textcolor[rgb]{0.10,0.09,0.49}{{#1}}}
    \newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.40,0.40,0.40}{{#1}}}
    \newcommand{\BuiltInTok}[1]{{#1}}
    \newcommand{\ExtensionTok}[1]{{#1}}
    \newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.74,0.48,0.00}{{#1}}}
    \newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.49,0.56,0.16}{{#1}}}
    \newcommand{\InformationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\WarningTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    
    
    % Define a nice break command that doesn't care if a line doesn't already
    % exist.
    \def\br{\hspace*{\fill} \\* }
    % Math Jax compatibility definitions
    \def\gt{>}
    \def\lt{<}
    \let\Oldtex\TeX
    \let\Oldlatex\LaTeX
    \renewcommand{\TeX}{\textrm{\Oldtex}}
    \renewcommand{\LaTeX}{\textrm{\Oldlatex}}
    % Document parameters
    % Document title
    \title{example1-clustering-products-fashion}
    
    
    
    
    
% Pygments definitions
\makeatletter
\def\PY@reset{\let\PY@it=\relax \let\PY@bf=\relax%
    \let\PY@ul=\relax \let\PY@tc=\relax%
    \let\PY@bc=\relax \let\PY@ff=\relax}
\def\PY@tok#1{\csname PY@tok@#1\endcsname}
\def\PY@toks#1+{\ifx\relax#1\empty\else%
    \PY@tok{#1}\expandafter\PY@toks\fi}
\def\PY@do#1{\PY@bc{\PY@tc{\PY@ul{%
    \PY@it{\PY@bf{\PY@ff{#1}}}}}}}
\def\PY#1#2{\PY@reset\PY@toks#1+\relax+\PY@do{#2}}

\@namedef{PY@tok@w}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.73,0.73}{##1}}}
\@namedef{PY@tok@c}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\@namedef{PY@tok@cp}{\def\PY@tc##1{\textcolor[rgb]{0.74,0.48,0.00}{##1}}}
\@namedef{PY@tok@k}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kp}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kt}{\def\PY@tc##1{\textcolor[rgb]{0.69,0.00,0.25}{##1}}}
\@namedef{PY@tok@o}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@ow}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\@namedef{PY@tok@nb}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@nf}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@nc}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@nn}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@ne}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.82,0.25,0.23}{##1}}}
\@namedef{PY@tok@nv}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@no}{\def\PY@tc##1{\textcolor[rgb]{0.53,0.00,0.00}{##1}}}
\@namedef{PY@tok@nl}{\def\PY@tc##1{\textcolor[rgb]{0.63,0.63,0.00}{##1}}}
\@namedef{PY@tok@ni}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.60,0.60,0.60}{##1}}}
\@namedef{PY@tok@na}{\def\PY@tc##1{\textcolor[rgb]{0.49,0.56,0.16}{##1}}}
\@namedef{PY@tok@nt}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@nd}{\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\@namedef{PY@tok@s}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sd}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@si}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\@namedef{PY@tok@se}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.13}{##1}}}
\@namedef{PY@tok@sr}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\@namedef{PY@tok@ss}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@sx}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@m}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@gh}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\@namedef{PY@tok@gu}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.50,0.00,0.50}{##1}}}
\@namedef{PY@tok@gd}{\def\PY@tc##1{\textcolor[rgb]{0.63,0.00,0.00}{##1}}}
\@namedef{PY@tok@gi}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.63,0.00}{##1}}}
\@namedef{PY@tok@gr}{\def\PY@tc##1{\textcolor[rgb]{1.00,0.00,0.00}{##1}}}
\@namedef{PY@tok@ge}{\let\PY@it=\textit}
\@namedef{PY@tok@gs}{\let\PY@bf=\textbf}
\@namedef{PY@tok@gp}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\@namedef{PY@tok@go}{\def\PY@tc##1{\textcolor[rgb]{0.53,0.53,0.53}{##1}}}
\@namedef{PY@tok@gt}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.27,0.87}{##1}}}
\@namedef{PY@tok@err}{\def\PY@bc##1{{\setlength{\fboxsep}{\string -\fboxrule}\fcolorbox[rgb]{1.00,0.00,0.00}{1,1,1}{\strut ##1}}}}
\@namedef{PY@tok@kc}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kd}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kn}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kr}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@bp}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@fm}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@vc}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@vg}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@vi}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@vm}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@sa}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sb}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sc}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@dl}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@s2}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sh}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@s1}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@mb}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mf}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mh}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mi}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@il}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mo}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@ch}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\@namedef{PY@tok@cm}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\@namedef{PY@tok@cpf}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\@namedef{PY@tok@c1}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\@namedef{PY@tok@cs}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}

\def\PYZbs{\char`\\}
\def\PYZus{\char`\_}
\def\PYZob{\char`\{}
\def\PYZcb{\char`\}}
\def\PYZca{\char`\^}
\def\PYZam{\char`\&}
\def\PYZlt{\char`\<}
\def\PYZgt{\char`\>}
\def\PYZsh{\char`\#}
\def\PYZpc{\char`\%}
\def\PYZdl{\char`\$}
\def\PYZhy{\char`\-}
\def\PYZsq{\char`\'}
\def\PYZdq{\char`\"}
\def\PYZti{\char`\~}
% for compatibility with earlier versions
\def\PYZat{@}
\def\PYZlb{[}
\def\PYZrb{]}
\makeatother


    % For linebreaks inside Verbatim environment from package fancyvrb. 
    \makeatletter
        \newbox\Wrappedcontinuationbox 
        \newbox\Wrappedvisiblespacebox 
        \newcommand*\Wrappedvisiblespace {\textcolor{red}{\textvisiblespace}} 
        \newcommand*\Wrappedcontinuationsymbol {\textcolor{red}{\llap{\tiny$\m@th\hookrightarrow$}}} 
        \newcommand*\Wrappedcontinuationindent {3ex } 
        \newcommand*\Wrappedafterbreak {\kern\Wrappedcontinuationindent\copy\Wrappedcontinuationbox} 
        % Take advantage of the already applied Pygments mark-up to insert 
        % potential linebreaks for TeX processing. 
        %        {, <, #, %, $, ' and ": go to next line. 
        %        _, }, ^, &, >, - and ~: stay at end of broken line. 
        % Use of \textquotesingle for straight quote. 
        \newcommand*\Wrappedbreaksatspecials {% 
            \def\PYGZus{\discretionary{\char`\_}{\Wrappedafterbreak}{\char`\_}}% 
            \def\PYGZob{\discretionary{}{\Wrappedafterbreak\char`\{}{\char`\{}}% 
            \def\PYGZcb{\discretionary{\char`\}}{\Wrappedafterbreak}{\char`\}}}% 
            \def\PYGZca{\discretionary{\char`\^}{\Wrappedafterbreak}{\char`\^}}% 
            \def\PYGZam{\discretionary{\char`\&}{\Wrappedafterbreak}{\char`\&}}% 
            \def\PYGZlt{\discretionary{}{\Wrappedafterbreak\char`\<}{\char`\<}}% 
            \def\PYGZgt{\discretionary{\char`\>}{\Wrappedafterbreak}{\char`\>}}% 
            \def\PYGZsh{\discretionary{}{\Wrappedafterbreak\char`\#}{\char`\#}}% 
            \def\PYGZpc{\discretionary{}{\Wrappedafterbreak\char`\%}{\char`\%}}% 
            \def\PYGZdl{\discretionary{}{\Wrappedafterbreak\char`\$}{\char`\$}}% 
            \def\PYGZhy{\discretionary{\char`\-}{\Wrappedafterbreak}{\char`\-}}% 
            \def\PYGZsq{\discretionary{}{\Wrappedafterbreak\textquotesingle}{\textquotesingle}}% 
            \def\PYGZdq{\discretionary{}{\Wrappedafterbreak\char`\"}{\char`\"}}% 
            \def\PYGZti{\discretionary{\char`\~}{\Wrappedafterbreak}{\char`\~}}% 
        } 
        % Some characters . , ; ? ! / are not pygmentized. 
        % This macro makes them "active" and they will insert potential linebreaks 
        \newcommand*\Wrappedbreaksatpunct {% 
            \lccode`\~`\.\lowercase{\def~}{\discretionary{\hbox{\char`\.}}{\Wrappedafterbreak}{\hbox{\char`\.}}}% 
            \lccode`\~`\,\lowercase{\def~}{\discretionary{\hbox{\char`\,}}{\Wrappedafterbreak}{\hbox{\char`\,}}}% 
            \lccode`\~`\;\lowercase{\def~}{\discretionary{\hbox{\char`\;}}{\Wrappedafterbreak}{\hbox{\char`\;}}}% 
            \lccode`\~`\:\lowercase{\def~}{\discretionary{\hbox{\char`\:}}{\Wrappedafterbreak}{\hbox{\char`\:}}}% 
            \lccode`\~`\?\lowercase{\def~}{\discretionary{\hbox{\char`\?}}{\Wrappedafterbreak}{\hbox{\char`\?}}}% 
            \lccode`\~`\!\lowercase{\def~}{\discretionary{\hbox{\char`\!}}{\Wrappedafterbreak}{\hbox{\char`\!}}}% 
            \lccode`\~`\/\lowercase{\def~}{\discretionary{\hbox{\char`\/}}{\Wrappedafterbreak}{\hbox{\char`\/}}}% 
            \catcode`\.\active
            \catcode`\,\active 
            \catcode`\;\active
            \catcode`\:\active
            \catcode`\?\active
            \catcode`\!\active
            \catcode`\/\active 
            \lccode`\~`\~ 	
        }
    \makeatother

    \let\OriginalVerbatim=\Verbatim
    \makeatletter
    \renewcommand{\Verbatim}[1][1]{%
        %\parskip\z@skip
        \sbox\Wrappedcontinuationbox {\Wrappedcontinuationsymbol}%
        \sbox\Wrappedvisiblespacebox {\FV@SetupFont\Wrappedvisiblespace}%
        \def\FancyVerbFormatLine ##1{\hsize\linewidth
            \vtop{\raggedright\hyphenpenalty\z@\exhyphenpenalty\z@
                \doublehyphendemerits\z@\finalhyphendemerits\z@
                \strut ##1\strut}%
        }%
        % If the linebreak is at a space, the latter will be displayed as visible
        % space at end of first line, and a continuation symbol starts next line.
        % Stretch/shrink are however usually zero for typewriter font.
        \def\FV@Space {%
            \nobreak\hskip\z@ plus\fontdimen3\font minus\fontdimen4\font
            \discretionary{\copy\Wrappedvisiblespacebox}{\Wrappedafterbreak}
            {\kern\fontdimen2\font}%
        }%
        
        % Allow breaks at special characters using \PYG... macros.
        \Wrappedbreaksatspecials
        % Breaks at punctuation characters . , ; ? ! and / need catcode=\active 	
        \OriginalVerbatim[#1,codes*=\Wrappedbreaksatpunct]%
    }
    \makeatother

    % Exact colors from NB
    \definecolor{incolor}{HTML}{303F9F}
    \definecolor{outcolor}{HTML}{D84315}
    \definecolor{cellborder}{HTML}{CFCFCF}
    \definecolor{cellbackground}{HTML}{F7F7F7}
    
    % prompt
    \makeatletter
    \newcommand{\boxspacing}{\kern\kvtcb@left@rule\kern\kvtcb@boxsep}
    \makeatother
    \newcommand{\prompt}[4]{
        {\ttfamily\llap{{\color{#2}[#3]:\hspace{3pt}#4}}\vspace{-\baselineskip}}
    }
    

    
    % Prevent overflowing lines due to hard-to-break entities
    \sloppy 
    % Setup hyperref package
    \hypersetup{
      breaklinks=true,  % so long urls are correctly broken across lines
      colorlinks=true,
      urlcolor=urlcolor,
      linkcolor=linkcolor,
      citecolor=citecolor,
      }
    % Slightly bigger margins than the latex defaults
    
    \geometry{verbose,tmargin=1in,bmargin=1in,lmargin=1in,rmargin=1in}
    
    

\begin{document}
    
    \maketitle
    
    

    
    \hypertarget{httpswww.kaggle.comcodeshubhijoshisimilar-image-finder-using-k-means}{%
\subsubsection{https://www.kaggle.com/code/shubhijoshi/similar-image-finder-using-k-means}\label{httpswww.kaggle.comcodeshubhijoshisimilar-image-finder-using-k-means}}

    \hypertarget{download-data-unzip}{%
\section{1. Download data \& unzip}\label{download-data-unzip}}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{8}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} ! pip install kaggle \PYZhy{}\PYZhy{}upgrade}
\PY{c+c1}{\PYZsh{} ! cd notebooks/xai\PYZhy{}survey \PYZam{}\PYZam{} ls \PYZam{}\PYZam{} kaggle datasets download \PYZhy{}d paramaggarwal/fashion\PYZhy{}product\PYZhy{}images\PYZhy{}small}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Defaulting to user installation because normal site-packages is not writeable
Requirement already satisfied: kaggle in ./.local/lib/python3.8/site-packages
(1.5.12)
Requirement already satisfied: urllib3 in /usr/lib/python3/dist-packages (from
kaggle) (1.25.8)
Requirement already satisfied: tqdm in ./.local/lib/python3.8/site-packages
(from kaggle) (4.62.2)
Requirement already satisfied: python-slugify in ./.local/lib/python3.8/site-
packages (from kaggle) (6.1.2)
Requirement already satisfied: python-dateutil in /usr/lib/python3/dist-packages
(from kaggle) (2.7.3)
Requirement already satisfied: requests in ./.local/lib/python3.8/site-packages
(from kaggle) (2.27.1)
Requirement already satisfied: six>=1.10 in /usr/lib/python3/dist-packages (from
kaggle) (1.14.0)
Requirement already satisfied: certifi in /usr/lib/python3/dist-packages (from
kaggle) (2019.11.28)
Requirement already satisfied: text-unidecode>=1.3 in
./.local/lib/python3.8/site-packages (from python-slugify->kaggle) (1.3)
Requirement already satisfied: charset-normalizer\textasciitilde{}=2.0.0 in
./.local/lib/python3.8/site-packages (from requests->kaggle) (2.0.4)
Requirement already satisfied: idna<4,>=2.5 in /usr/lib/python3/dist-packages
(from requests->kaggle) (2.8)
\textcolor{ansi-yellow}{WARNING: You are using pip version 22.0.4; however, version 22.1 is
available.
You should consider upgrading via the '/usr/bin/python3 -m pip install --upgrade
pip' command.}\textcolor{ansi-yellow}{
} All\_ref\_500.csv   clusters-embeddings       intents\_500.xlsx
 archive.zip       Data.xlsx            'RC6 nodes info(Abstract).xlsx'
 art\_dataset       HMRServer.jar        'RC6 nodes info.xlsx'
Warning: Your Kaggle API key is readable by other users on this system! To fix
this, you can run 'chmod 600 /home/mmozolewski/.kaggle/kaggle.json'
Downloading fashion-product-images-small.zip to /home/mmozolewski/notebooks/xai-
survey
100\%|███████████████████████████████████████▉| 565M/565M [00:51<00:00, 11.7MB/s]
100\%|████████████████████████████████████████| 565M/565M [00:51<00:00, 11.5MB/s]
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{1}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} ! apt\PYZhy{}get install unzip}
\PY{c+c1}{\PYZsh{} ! cd notebooks/xai\PYZhy{}survey \PYZam{}\PYZam{} unzip fashion\PYZhy{}product\PYZhy{}images\PYZhy{}small.zip}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Archive:  fashion-product-images-small.zip
  inflating: images/10000.jpg
  ...
  inflating: myntradataset/images/9999.jpg
  inflating: myntradataset/styles.csv
  inflating: styles.csv
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{5}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{o}{!} \PY{n+nb}{cd} notebooks/xai\PYZhy{}survey \PY{o}{\PYZam{}\PYZam{}} ls
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
 All\_ref\_500.csv                    images
 art\_dataset                        intents\_500.xlsx
 clusters-embeddings                myntradataset
 Data.xlsx                         'RC6 nodes info(Abstract).xlsx'
 fashion-product-images-small.zip  'RC6 nodes info.xlsx'
 HMRServer.jar                      styles.csv
    \end{Verbatim}

    \hypertarget{importing-libraries-define-function}{%
\section{2. Importing Libraries \& define
function}\label{importing-libraries-define-function}}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{4}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} ! pip install opencv\PYZhy{}python}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Defaulting to user installation because normal site-packages is not writeable
Requirement already satisfied: opencv-python in ./.local/lib/python3.8/site-
packages (4.5.5.64)
Requirement already satisfied: numpy>=1.14.5 in ./.local/lib/python3.8/site-
packages (from opencv-python) (1.21.0)
\textcolor{ansi-yellow}{WARNING: You are using pip version 22.0.4; however, version 22.1 is
available.
You should consider upgrading via the '/usr/bin/python3 -m pip install --upgrade
pip' command.}\textcolor{ansi-yellow}{
}
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{2}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{import} \PY{n+nn}{datetime}
\PY{k+kn}{import} \PY{n+nn}{sys}

\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{UTC now= }\PY{l+s+s2}{\PYZsq{}}\PY{l+s+si}{\PYZob{}}\PY{n}{datetime}\PY{o}{.}\PY{n}{datetime}\PY{o}{.}\PY{n}{utcnow}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{isoformat}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{split}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Virtualenv used: }\PY{l+s+si}{\PYZob{}}\PY{n}{sys}\PY{o}{.}\PY{n}{executable}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{k+kn}{import} \PY{n+nn}{importlib}


\PY{k+kn}{import} \PY{n+nn}{numpy} \PY{k}{as} \PY{n+nn}{np}
\PY{k+kn}{import} \PY{n+nn}{pandas} \PY{k}{as} \PY{n+nn}{pd}
\PY{k+kn}{import} \PY{n+nn}{ast}
\PY{k+kn}{import} \PY{n+nn}{pickle}
\PY{k+kn}{import} \PY{n+nn}{math}

\PY{k+kn}{from} \PY{n+nn}{pathlib} \PY{k+kn}{import} \PY{n}{Path}

\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{cluster} \PY{k+kn}{import} \PY{n}{KMeans}

\PY{c+c1}{\PYZsh{}for text pre\PYZhy{}processing}
\PY{k+kn}{import} \PY{n+nn}{re}\PY{o}{,} \PY{n+nn}{string}

\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{decomposition} \PY{k+kn}{import} \PY{n}{TruncatedSVD}
\PY{c+c1}{\PYZsh{} bag of words}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{feature\PYZus{}extraction}\PY{n+nn}{.}\PY{n+nn}{text} \PY{k+kn}{import} \PY{n}{CountVectorizer}\PY{p}{,} \PY{n}{TfidfVectorizer}\PY{p}{,} \PY{n}{HashingVectorizer}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{pipeline} \PY{k+kn}{import} \PY{n}{make\PYZus{}pipeline}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{preprocessing} \PY{k+kn}{import} \PY{n}{Normalizer}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{tree} \PY{k+kn}{import} \PY{n}{DecisionTreeClassifier}
\PY{c+c1}{\PYZsh{}for model\PYZhy{}building}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{metrics} \PY{k+kn}{import} \PY{n}{classification\PYZus{}report}\PY{p}{,} \PY{n}{f1\PYZus{}score}\PY{p}{,} \PY{n}{accuracy\PYZus{}score}\PY{p}{,} \PY{n}{confusion\PYZus{}matrix}\PY{p}{,}\PY{n}{roc\PYZus{}curve}\PY{p}{,}\PY{n}{auc}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{metrics} \PY{k+kn}{import} \PY{n}{accuracy\PYZus{}score}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{model\PYZus{}selection} \PY{k+kn}{import} \PY{n}{train\PYZus{}test\PYZus{}split}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{preprocessing} \PY{k+kn}{import} \PY{n}{MinMaxScaler}

\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{linear\PYZus{}model} \PY{k+kn}{import} \PY{n}{LogisticRegression}
\PY{k+kn}{from} \PY{n+nn}{xgboost} \PY{k+kn}{import} \PY{n}{XGBClassifier}

\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{manifold} \PY{k+kn}{import} \PY{n}{TSNE}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{decomposition} \PY{k+kn}{import} \PY{n}{PCA}

\PY{k+kn}{import} \PY{n+nn}{seaborn} \PY{k}{as} \PY{n+nn}{sns}
\PY{k+kn}{import} \PY{n+nn}{matplotlib}\PY{n+nn}{.}\PY{n+nn}{pyplot} \PY{k}{as} \PY{n+nn}{plt}

\PY{k+kn}{from} \PY{n+nn}{sklearn} \PY{k+kn}{import} \PY{n}{tree}

\PY{k+kn}{from} \PY{n+nn}{sentence\PYZus{}transformers} \PY{k+kn}{import} \PY{n}{SentenceTransformer}
\PY{n}{sentence\PYZus{}bert\PYZus{}model} \PY{o}{=} \PY{n}{SentenceTransformer}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{distiluse\PYZhy{}base\PYZhy{}multilingual\PYZhy{}cased\PYZhy{}v1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{k+kn}{import} \PY{n+nn}{spacy}
\PY{n}{importlib}\PY{o}{.}\PY{n}{reload}\PY{p}{(}\PY{n}{spacy}\PY{p}{)}
\PY{n}{spacy\PYZus{}nlp\PYZus{}model} \PY{o}{=} \PY{n}{spacy}\PY{o}{.}\PY{n}{load}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{en\PYZus{}core\PYZus{}web\PYZus{}lg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{k+kn}{from} \PY{n+nn}{scipy}\PY{n+nn}{.}\PY{n+nn}{optimize} \PY{k+kn}{import} \PY{n}{minimize\PYZus{}scalar}

\PY{k+kn}{import} \PY{n+nn}{nltk}
\PY{n}{nltk}\PY{o}{.}\PY{n}{download}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{punkt}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{nltk}\PY{o}{.}\PY{n}{download}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{stopwords}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{nltk}\PY{o}{.}\PY{n}{download}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{averaged\PYZus{}perceptron\PYZus{}tagger}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{nltk}\PY{o}{.}\PY{n}{download}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{wordnet}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{nltk}\PY{o}{.}\PY{n}{download}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{omw\PYZhy{}1.4}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{k+kn}{from} \PY{n+nn}{nltk}\PY{n+nn}{.}\PY{n+nn}{tokenize} \PY{k+kn}{import} \PY{n}{word\PYZus{}tokenize}
\PY{k+kn}{from} \PY{n+nn}{nltk}\PY{n+nn}{.}\PY{n+nn}{stem} \PY{k+kn}{import} \PY{n}{WordNetLemmatizer}

\PY{c+c1}{\PYZsh{} Initialize the lemmatizer}
\PY{n}{wl} \PY{o}{=} \PY{n}{WordNetLemmatizer}\PY{p}{(}\PY{p}{)}

\PY{k+kn}{from} \PY{n+nn}{nltk}\PY{n+nn}{.}\PY{n+nn}{corpus} \PY{k+kn}{import} \PY{n}{wordnet}\PY{p}{,} \PY{n}{stopwords}

\PY{k+kn}{from} \PY{n+nn}{wordcloud} \PY{k+kn}{import} \PY{n}{WordCloud}\PY{p}{,} \PY{n}{STOPWORDS}\PY{p}{,} \PY{n}{ImageColorGenerator}

\PY{c+c1}{\PYZsh{} for LIME import necessary packages}
\PY{k+kn}{from} \PY{n+nn}{lime}\PY{n+nn}{.}\PY{n+nn}{lime\PYZus{}text} \PY{k+kn}{import} \PY{n}{LimeTextExplainer}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{pipeline} \PY{k+kn}{import} \PY{n}{make\PYZus{}pipeline}
\PY{k+kn}{from} \PY{n+nn}{random} \PY{k+kn}{import} \PY{n}{randint}

\PY{k+kn}{from} \PY{n+nn}{typing} \PY{k+kn}{import} \PY{n}{List}\PY{p}{,} \PY{n}{Optional}\PY{p}{,} \PY{n}{Union}\PY{p}{,} \PY{n}{Tuple}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
UTC now= '2022-05-15T19:22:28'
Virtualenv used: /usr/bin/python3
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
[nltk\_data] Downloading package punkt to
[nltk\_data]     /home/mmozolewski/nltk\_data{\ldots}
[nltk\_data]   Package punkt is already up-to-date!
[nltk\_data] Downloading package stopwords to
[nltk\_data]     /home/mmozolewski/nltk\_data{\ldots}
[nltk\_data]   Package stopwords is already up-to-date!
[nltk\_data] Downloading package averaged\_perceptron\_tagger to
[nltk\_data]     /home/mmozolewski/nltk\_data{\ldots}
[nltk\_data]   Package averaged\_perceptron\_tagger is already up-to-
[nltk\_data]       date!
[nltk\_data] Downloading package wordnet to
[nltk\_data]     /home/mmozolewski/nltk\_data{\ldots}
[nltk\_data]   Package wordnet is already up-to-date!
[nltk\_data] Downloading package omw-1.4 to
[nltk\_data]     /home/mmozolewski/nltk\_data{\ldots}
[nltk\_data]   Package omw-1.4 is already up-to-date!
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{6}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{import} \PY{n+nn}{numpy} \PY{k}{as} \PY{n+nn}{np} 
\PY{k+kn}{import} \PY{n+nn}{tensorflow} \PY{k}{as} \PY{n+nn}{tf}
\PY{k+kn}{from} \PY{n+nn}{tensorflow} \PY{k+kn}{import} \PY{n}{keras}
\PY{k+kn}{import} \PY{n+nn}{matplotlib}\PY{n+nn}{.}\PY{n+nn}{pyplot} \PY{k}{as} \PY{n+nn}{plt}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{cluster} \PY{k+kn}{import} \PY{n}{KMeans}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{metrics} \PY{k+kn}{import} \PY{n}{silhouette\PYZus{}score}
\PY{k+kn}{import} \PY{n+nn}{cv2}
\PY{k+kn}{import} \PY{n+nn}{os}\PY{o}{,} \PY{n+nn}{glob}\PY{o}{,} \PY{n+nn}{shutil}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{103}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{def} \PY{n+nf}{\PYZus{}save\PYZus{}pickle}\PY{p}{(}\PY{n}{df}\PY{p}{,} \PY{n}{outfile}\PY{p}{,} \PY{n}{results\PYZus{}folder}\PY{p}{)}\PY{p}{:}
  \PY{k}{if} \PY{n}{results\PYZus{}folder}\PY{p}{:}
    \PY{n}{results\PYZus{}folder\PYZus{}local} \PY{o}{=} \PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+si}{\PYZob{}}\PY{n+nb}{str}\PY{p}{(}\PY{n}{Path}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZti{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{o}{.}\PY{n}{expanduser}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{resolve}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{/}\PY{l+s+si}{\PYZob{}}\PY{n}{results\PYZus{}folder}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}
    \PY{c+c1}{\PYZsh{} results\PYZus{}folder\PYZus{}local = results\PYZus{}folder}
  \PY{k}{else}\PY{p}{:}
    \PY{n}{results\PYZus{}folder\PYZus{}local} \PY{o}{=} \PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+si}{\PYZob{}}\PY{n+nb}{str}\PY{p}{(}\PY{n}{Path}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZti{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{o}{.}\PY{n}{expanduser}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{resolve}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{/data}\PY{l+s+s2}{\PYZdq{}}
  \PY{n}{Path}\PY{p}{(}\PY{n}{results\PYZus{}folder\PYZus{}local}\PY{p}{)}\PY{o}{.}\PY{n}{mkdir}\PY{p}{(}\PY{n}{parents}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,} \PY{n}{exist\PYZus{}ok}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
  \PY{n}{fname} \PY{o}{=} \PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+si}{\PYZob{}}\PY{n}{results\PYZus{}folder\PYZus{}local}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{/}\PY{l+s+si}{\PYZob{}}\PY{n}{outfile}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{.pickle}\PY{l+s+s2}{\PYZdq{}}
  \PY{n+nb}{print}\PY{p}{(}\PY{n}{fname}\PY{p}{)}
  \PY{k}{with} \PY{n+nb}{open}\PY{p}{(}\PY{n}{fname}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{wb}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)} \PY{k}{as} \PY{n}{f}\PY{p}{:}
    \PY{n}{pickle}\PY{o}{.}\PY{n}{dump}\PY{p}{(}\PY{n}{df}\PY{p}{,} \PY{n}{f}\PY{p}{)}


\PY{k}{def} \PY{n+nf}{\PYZus{}read\PYZus{}pandas\PYZus{}pickle}\PY{p}{(}\PY{n}{infile}\PY{p}{,} \PY{n}{data\PYZus{}folder}\PY{p}{)}\PY{p}{:}
  \PY{n}{fname} \PY{o}{=} \PY{l+s+sa}{f}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+si}{\PYZob{}}\PY{n}{data\PYZus{}folder}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s1}{/}\PY{l+s+si}{\PYZob{}}\PY{n}{infile}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s1}{.pickle}\PY{l+s+s1}{\PYZsq{}}
  \PY{k}{return} \PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}pickle}\PY{p}{(}\PY{n}{fname}\PY{p}{)}


\PY{k}{def} \PY{n+nf}{get\PYZus{}LSA}\PY{p}{(}\PY{n}{df}\PY{p}{:}\PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{,} \PY{n}{column\PYZus{}to\PYZus{}omit}\PY{p}{:}\PY{n+nb}{str}\PY{p}{,} \PY{n}{how\PYZus{}many\PYZus{}dimension}\PY{p}{:}\PY{n+nb}{int}\PY{p}{,} \PY{n}{random\PYZus{}subsample}\PY{p}{:}\PY{n}{Optional}\PY{p}{[}\PY{n+nb}{float}\PY{p}{]}\PY{p}{)} \PY{o}{\PYZhy{}}\PY{o}{\PYZgt{}} \PY{n}{Optional}\PY{p}{[}\PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{]}\PY{p}{:}
    \PY{n}{svd} \PY{o}{=} \PY{n}{TruncatedSVD}\PY{p}{(}\PY{n}{how\PYZus{}many\PYZus{}dimension}\PY{p}{)}
    \PY{n}{normalizer} \PY{o}{=} \PY{n}{Normalizer}\PY{p}{(}\PY{n}{copy}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}
    \PY{n}{lsa} \PY{o}{=} \PY{n}{make\PYZus{}pipeline}\PY{p}{(}\PY{n}{svd}\PY{p}{,} \PY{n}{normalizer}\PY{p}{)}
    \PY{k}{if} \PY{n}{random\PYZus{}subsample}\PY{p}{:}
      \PY{n}{\PYZus{}df} \PY{o}{=} \PY{n}{df}\PY{o}{.}\PY{n}{sample}\PY{p}{(}\PY{n}{frac}\PY{o}{=}\PY{n}{random\PYZus{}subsample}\PY{p}{)}
      \PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{using }\PY{l+s+si}{\PYZob{}}\PY{n+nb}{len}\PY{p}{(}\PY{n}{\PYZus{}df}\PY{o}{.}\PY{n}{index}\PY{p}{)}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{ observations}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
      \PY{n}{lsa}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{\PYZus{}df}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{n}{df}\PY{o}{.}\PY{n}{columns} \PY{o}{!=} \PY{n}{column\PYZus{}to\PYZus{}omit}\PY{p}{]}\PY{p}{)}
    \PY{k}{else}\PY{p}{:}
      \PY{n}{lsa}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{df}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{n}{df}\PY{o}{.}\PY{n}{columns} \PY{o}{!=} \PY{n}{column\PYZus{}to\PYZus{}omit}\PY{p}{]}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{explained variance perc = }\PY{l+s+si}{\PYZob{}}\PY{n}{svd}\PY{o}{.}\PY{n}{explained\PYZus{}variance\PYZus{}ratio\PYZus{}}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{p}{)}\PY{o}{*}\PY{l+m+mi}{100}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZpc{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}

    \PY{n}{chunk\PYZus{}size} \PY{o}{=} \PY{l+m+mi}{1\PYZus{}000}
    \PY{n}{rows\PYZus{}count} \PY{o}{=} \PY{n+nb}{len}\PY{p}{(}\PY{n}{df}\PY{o}{.}\PY{n}{index}\PY{p}{)}
    \PY{n}{chunks} \PY{o}{=} \PY{n+nb}{list}\PY{p}{(}\PY{p}{)}
    \PY{n}{num\PYZus{}chunks} \PY{o}{=} \PY{n}{rows\PYZus{}count} \PY{o}{/}\PY{o}{/} \PY{n}{chunk\PYZus{}size} \PY{o}{+} \PY{l+m+mi}{1}
    \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{num\PYZus{}chunks}\PY{p}{)}\PY{p}{:}
      \PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{processing chunk }\PY{l+s+si}{\PYZob{}}\PY{n+nb}{str}\PY{p}{(}\PY{n}{i}\PY{p}{)}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{ of }\PY{l+s+si}{\PYZob{}}\PY{n+nb}{str}\PY{p}{(}\PY{n}{num\PYZus{}chunks}\PY{p}{)}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
      \PY{n}{chunks}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{lsa}\PY{o}{.}\PY{n}{transform}\PY{p}{(}\PY{n}{df}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{i}\PY{o}{*}\PY{n}{chunk\PYZus{}size} \PY{p}{:} \PY{n+nb}{min}\PY{p}{(}\PY{n}{rows\PYZus{}count}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{p}{(}\PY{n}{i}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{)}\PY{o}{*}\PY{n}{chunk\PYZus{}size}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,} \PY{n}{df}\PY{o}{.}\PY{n}{columns} \PY{o}{!=} \PY{n}{column\PYZus{}to\PYZus{}omit}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{)}
    \PY{n}{\PYZus{}df\PYZus{}lsa} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{concat}\PY{p}{(}\PY{n}{chunks}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}

    \PY{n}{\PYZus{}df\PYZus{}lsa} \PY{o}{=} \PY{n}{\PYZus{}df\PYZus{}lsa}\PY{o}{.}\PY{n}{reset\PYZus{}index}\PY{p}{(}\PY{p}{)}
    \PY{k}{del} \PY{n}{\PYZus{}df\PYZus{}lsa}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{index}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}

    \PY{n}{\PYZus{}df\PYZus{}lsa}\PY{p}{[}\PY{n}{column\PYZus{}to\PYZus{}omit}\PY{p}{]} \PY{o}{=} \PY{n}{df}\PY{p}{[}\PY{n}{column\PYZus{}to\PYZus{}omit}\PY{p}{]}
    \PY{k}{return} \PY{n}{\PYZus{}df\PYZus{}lsa}


\PY{k}{def} \PY{n+nf}{get\PYZus{}TSNE\PYZus{}and\PYZus{}PCA\PYZus{}embeddings}\PY{p}{(}\PY{n}{df}\PY{p}{:}\PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{,} \PY{n}{key}\PY{p}{:}\PY{n+nb}{str}\PY{p}{,} \PY{n}{random\PYZus{}subsample}\PY{p}{:}\PY{n}{Optional}\PY{p}{[}\PY{n+nb}{float}\PY{p}{]}\PY{p}{,} \PY{n}{incl\PYZus{}pca}\PY{p}{:}\PY{n+nb}{bool} \PY{o}{=} \PY{k+kc}{True}\PY{p}{)}\PY{p}{:}
  \PY{k}{if} \PY{n}{random\PYZus{}subsample}\PY{p}{:}
    \PY{n}{\PYZus{}df} \PY{o}{=} \PY{n}{df}\PY{o}{.}\PY{n}{sample}\PY{p}{(}\PY{n}{frac}\PY{o}{=}\PY{n}{random\PYZus{}subsample}\PY{p}{)}
    \PY{n}{\PYZus{}df}\PY{o}{.}\PY{n}{reset\PYZus{}index}\PY{p}{(}\PY{n}{inplace}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
    \PY{k}{del} \PY{n}{\PYZus{}df}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{index}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{using }\PY{l+s+si}{\PYZob{}}\PY{n+nb}{len}\PY{p}{(}\PY{n}{\PYZus{}df}\PY{o}{.}\PY{n}{index}\PY{p}{)}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{ observations}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n}{df\PYZus{}independent\PYZus{}vars} \PY{o}{=} \PY{n}{\PYZus{}df}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{p}{(}\PY{n}{df}\PY{o}{.}\PY{n}{columns} \PY{o}{!=} \PY{n}{key}\PY{p}{)} \PY{o}{\PYZam{}} \PY{p}{(}\PY{n}{df}\PY{o}{.}\PY{n}{columns} \PY{o}{!=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{cluster\PYZus{}kmeans}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{]}
  \PY{k}{else}\PY{p}{:}
    \PY{n}{\PYZus{}df} \PY{o}{=} \PY{n}{df}
    \PY{n}{df\PYZus{}independent\PYZus{}vars} \PY{o}{=} \PY{n}{df}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{p}{(}\PY{n}{df}\PY{o}{.}\PY{n}{columns} \PY{o}{!=} \PY{n}{key}\PY{p}{)} \PY{o}{\PYZam{}} \PY{p}{(}\PY{n}{df}\PY{o}{.}\PY{n}{columns} \PY{o}{!=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{cluster\PYZus{}kmeans}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{]}

  \PY{n}{df\PYZus{}tsne} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{TSNE}\PY{p}{(}\PY{n}{n\PYZus{}components}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}\PY{o}{.}\PY{n}{fit\PYZus{}transform}\PY{p}{(}\PY{n}{df\PYZus{}independent\PYZus{}vars}\PY{p}{)}\PY{p}{)}
  \PY{n}{df\PYZus{}tsne}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{cluster}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{\PYZus{}df}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{cluster\PYZus{}kmeans}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
  \PY{n}{df\PYZus{}tsne}\PY{o}{.}\PY{n}{columns} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{cluster}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
  \PY{n}{df\PYZus{}tsne}\PY{p}{[}\PY{n}{key}\PY{p}{]} \PY{o}{=} \PY{n}{\PYZus{}df}\PY{p}{[}\PY{n}{key}\PY{p}{]}

  \PY{n}{df\PYZus{}tsne}\PY{p}{[}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]} \PY{o}{=} \PY{n}{MinMaxScaler}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{fit\PYZus{}transform}\PY{p}{(}\PY{n}{df\PYZus{}tsne}\PY{p}{[}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}\PY{p}{)}

  \PY{k}{if} \PY{n}{incl\PYZus{}pca}\PY{p}{:}
    \PY{n}{df\PYZus{}pca} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{PCA}\PY{p}{(}\PY{n}{n\PYZus{}components}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}\PY{o}{.}\PY{n}{fit\PYZus{}transform}\PY{p}{(}\PY{n}{df\PYZus{}independent\PYZus{}vars}\PY{p}{)}\PY{p}{)}
    \PY{n}{df\PYZus{}pca}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{cluster}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{\PYZus{}df}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{cluster\PYZus{}kmeans}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
    \PY{n}{df\PYZus{}pca}\PY{o}{.}\PY{n}{columns} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{cluster}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
    \PY{n}{df\PYZus{}pca}\PY{p}{[}\PY{n}{key}\PY{p}{]} \PY{o}{=} \PY{n}{\PYZus{}df}\PY{p}{[}\PY{n}{key}\PY{p}{]}

    \PY{n}{df\PYZus{}pca}\PY{p}{[}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]} \PY{o}{=} \PY{n}{MinMaxScaler}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{fit\PYZus{}transform}\PY{p}{(}\PY{n}{df\PYZus{}pca}\PY{p}{[}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}\PY{p}{)}
  \PY{k}{else}\PY{p}{:}
    \PY{n}{df\PYZus{}pca} \PY{o}{=} \PY{k+kc}{None}

  \PY{k}{return} \PY{n}{df\PYZus{}tsne}\PY{p}{,} \PY{n}{df\PYZus{}pca}


\PY{k}{def} \PY{n+nf}{k\PYZus{}means}\PY{p}{(}\PY{n}{df}\PY{p}{,} \PY{n}{column\PYZus{}to\PYZus{}omit}\PY{p}{,} \PY{n}{how\PYZus{}many\PYZus{}clusters}\PY{p}{)}\PY{p}{:}
  \PY{n}{kmeans} \PY{o}{=} \PY{n}{KMeans}\PY{p}{(}\PY{n}{n\PYZus{}clusters}\PY{o}{=}\PY{n}{how\PYZus{}many\PYZus{}clusters}\PY{p}{,} \PY{n}{random\PYZus{}state}\PY{o}{=}\PY{l+m+mi}{2022}\PY{p}{)}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{df}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{p}{(}\PY{n}{df}\PY{o}{.}\PY{n}{columns} \PY{o}{!=} \PY{n}{column\PYZus{}to\PYZus{}omit}\PY{p}{)} \PY{o}{\PYZam{}} \PY{p}{(}\PY{n}{df}\PY{o}{.}\PY{n}{columns} \PY{o}{!=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{cluster\PYZus{}kmeans}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{]}\PY{p}{)}
  \PY{n}{df}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{cluster\PYZus{}kmeans}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{kmeans}\PY{o}{.}\PY{n}{labels\PYZus{}}
  \PY{n}{df}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{cluster\PYZus{}kmeans}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{df}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{cluster\PYZus{}kmeans}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{astype}\PY{p}{(}\PY{n+nb}{int}\PY{p}{)}
  \PY{k}{return} \PY{n}{df}


\PY{k}{def} \PY{n+nf}{get\PYZus{}image\PYZus{}path}\PY{p}{(}\PY{n+nb}{id}\PY{p}{:}\PY{n}{Union}\PY{p}{[}\PY{n+nb}{int}\PY{p}{,} \PY{n+nb}{str}\PY{p}{]}\PY{p}{)}\PY{p}{:}
  \PY{k}{return} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{notebooks/xai\PYZhy{}survey/images/}\PY{l+s+s1}{\PYZsq{}} \PY{o}{+} \PY{n+nb}{str}\PY{p}{(}\PY{n+nb}{id}\PY{p}{)} \PY{o}{+} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{.jpg}\PY{l+s+s1}{\PYZsq{}}

\PY{c+c1}{\PYZsh{}\PYZsh{}\PYZsh{}\PYZsh{} Plotting image from each cluster}
\PY{k}{def} \PY{n+nf}{plot\PYZus{}example}\PY{p}{(}\PY{n}{df\PYZus{}with\PYZus{}cluster\PYZus{}kmeans\PYZus{}column}\PY{p}{:}\PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{,} \PY{n}{cluster}\PY{p}{:}\PY{n}{Union}\PY{p}{[}\PY{n+nb}{int}\PY{p}{,} \PY{n+nb}{str}\PY{p}{]}\PY{p}{,} \PY{n}{examples\PYZus{}count}\PY{p}{:}\PY{n+nb}{int}\PY{p}{,} \PY{n}{axs}\PY{p}{)}\PY{p}{:}
  \PY{n}{xyz} \PY{o}{=} \PY{n}{df\PYZus{}with\PYZus{}cluster\PYZus{}kmeans\PYZus{}column}\PY{o}{.}\PY{n}{loc}\PY{p}{[}
    \PY{n}{df\PYZus{}with\PYZus{}cluster\PYZus{}kmeans\PYZus{}column}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{cluster\PYZus{}kmeans}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{apply}\PY{p}{(}\PY{k}{lambda} \PY{n}{x}\PY{p}{:} \PY{n+nb}{str}\PY{p}{(}\PY{n}{x}\PY{p}{)} \PY{o}{==} \PY{n+nb}{str}\PY{p}{(}\PY{n}{cluster}\PY{p}{)}\PY{p}{)}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{id}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{sample}\PY{p}{(}\PY{n}{n}\PY{o}{=}\PY{n}{examples\PYZus{}count}\PY{p}{)}\PY{o}{.}\PY{n}{apply}\PY{p}{(}\PY{k}{lambda} \PY{n}{x}\PY{p}{:} \PY{n}{get\PYZus{}image\PYZus{}path}\PY{p}{(}\PY{n}{x}\PY{p}{)}\PY{p}{)}\PY{o}{.}\PY{n}{tolist}\PY{p}{(}\PY{p}{)}
  \PY{n}{img} \PY{o}{=} \PY{p}{[}\PY{n}{cv2}\PY{o}{.}\PY{n}{imread}\PY{p}{(}\PY{n}{abc}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{)} \PY{k}{for} \PY{n}{abc} \PY{o+ow}{in} \PY{n}{xyz}\PY{p}{]}
  \PY{c+c1}{\PYZsh{}print(\PYZdq{}Cluster No \PYZdq{}+str(i))}
  \PY{k}{for} \PY{n}{j} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n+nb}{min}\PY{p}{(}\PY{n}{examples\PYZus{}count}\PY{p}{,} \PY{n+nb}{len}\PY{p}{(}\PY{n}{img}\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{p}{:}
    \PY{k}{try}\PY{p}{:}
      \PY{n}{axs}\PY{p}{[}\PY{n}{cluster}\PY{p}{]}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{img}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{,} \PY{n}{cmap} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{gray}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{interpolation} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{bicubic}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
      \PY{n}{axs}\PY{p}{[}\PY{n}{cluster}\PY{p}{]}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}xticks}\PY{p}{(}\PY{p}{[}\PY{p}{]}\PY{p}{)}
      \PY{n}{axs}\PY{p}{[}\PY{n}{cluster}\PY{p}{]}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}yticks}\PY{p}{(}\PY{p}{[}\PY{p}{]}\PY{p}{)}
    \PY{k}{except}\PY{p}{:}
      \PY{n}{axs}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{img}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{,} \PY{n}{cmap} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{gray}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{interpolation} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{bicubic}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
      \PY{n}{axs}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}xticks}\PY{p}{(}\PY{p}{[}\PY{p}{]}\PY{p}{)}
      \PY{n}{axs}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}yticks}\PY{p}{(}\PY{p}{[}\PY{p}{]}\PY{p}{)}


\PY{k}{def} \PY{n+nf}{plot\PYZus{}examples}\PY{p}{(}\PY{n}{df\PYZus{}with\PYZus{}cluster\PYZus{}kmeans\PYZus{}column}\PY{p}{:}\PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{,} \PY{n}{examples\PYZus{}count}\PY{p}{:}\PY{n+nb}{int}\PY{p}{)}\PY{p}{:}
  \PY{n}{n\PYZus{}clusters} \PY{o}{=} \PY{n+nb}{len}\PY{p}{(}\PY{n}{df\PYZus{}with\PYZus{}cluster\PYZus{}kmeans\PYZus{}column}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{cluster\PYZus{}kmeans}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{unique}\PY{p}{(}\PY{p}{)}\PY{p}{)}
  \PY{n}{fig}\PY{p}{,} \PY{n}{axs} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{n}{n\PYZus{}clusters}\PY{p}{,} \PY{n}{examples\PYZus{}count}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{50}\PY{p}{,} \PY{l+m+mi}{50}\PY{p}{)}\PY{p}{)} \PY{c+c1}{\PYZsh{}\PYZsh{}\PYZsh{} making subplot}
  \PY{k}{for} \PY{n}{cluster} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{n\PYZus{}clusters}\PY{p}{)}\PY{p}{:}
    \PY{n}{plot\PYZus{}example}\PY{p}{(}\PY{n}{df\PYZus{}with\PYZus{}cluster\PYZus{}kmeans\PYZus{}column}\PY{p}{,} \PY{n}{cluster}\PY{p}{,} \PY{n}{examples\PYZus{}count}\PY{p}{,} \PY{n}{axs}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{4}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{}convert to lowercase, strip and remove punctuations}
\PY{k}{def} \PY{n+nf}{preprocess}\PY{p}{(}\PY{n}{text}\PY{p}{,} \PY{n}{stopwords\PYZus{}list}\PY{p}{)}\PY{p}{:}
  \PY{n}{text} \PY{o}{=} \PY{n}{text}\PY{o}{.}\PY{n}{lower}\PY{p}{(}\PY{p}{)}
  \PY{n}{text} \PY{o}{=} \PY{n}{text}\PY{o}{.}\PY{n}{strip}\PY{p}{(}\PY{p}{)}
  \PY{n}{text} \PY{o}{=} \PY{n}{re}\PY{o}{.}\PY{n}{compile}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZlt{}.*?\PYZgt{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{o}{.}\PY{n}{sub}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{text}\PY{p}{)}
  \PY{n}{text} \PY{o}{=} \PY{n}{re}\PY{o}{.}\PY{n}{compile}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{[}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{]}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{n}{re}\PY{o}{.}\PY{n}{escape}\PY{p}{(}\PY{n}{string}\PY{o}{.}\PY{n}{punctuation}\PY{p}{)}\PY{p}{)}\PY{o}{.}\PY{n}{sub}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{text}\PY{p}{)}
  \PY{n}{text} \PY{o}{=} \PY{n}{re}\PY{o}{.}\PY{n}{sub}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{s+}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{text}\PY{p}{)}
  \PY{n}{text} \PY{o}{=} \PY{n}{re}\PY{o}{.}\PY{n}{sub}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{[[0\PYZhy{}9]*}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{]}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{text}\PY{p}{)}
  \PY{n}{text} \PY{o}{=} \PY{n}{re}\PY{o}{.}\PY{n}{sub}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{[\PYZca{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{w}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{s]}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n+nb}{str}\PY{p}{(}\PY{n}{text}\PY{p}{)}\PY{o}{.}\PY{n}{lower}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{strip}\PY{p}{(}\PY{p}{)}\PY{p}{)}
  \PY{n}{text} \PY{o}{=} \PY{n}{re}\PY{o}{.}\PY{n}{sub}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{d}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{text}\PY{p}{)}
  \PY{n}{text} \PY{o}{=} \PY{n}{re}\PY{o}{.}\PY{n}{sub}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{s+}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{text}\PY{p}{)}
  \PY{n}{text} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ }\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{p}{[}\PY{n}{i} \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n}{text}\PY{o}{.}\PY{n}{split}\PY{p}{(}\PY{p}{)} \PY{k}{if} \PY{n}{i} \PY{o+ow}{not} \PY{o+ow}{in} \PY{n+nb}{list}\PY{p}{(}\PY{n}{stopwords\PYZus{}list}\PY{p}{)}\PY{p}{]}\PY{p}{)}
  \PY{k}{return} \PY{n}{text}


\PY{c+c1}{\PYZsh{}LEMMATIZATION}
\PY{c+c1}{\PYZsh{} function to map NTLK position tags}
\PY{k}{def} \PY{n+nf}{get\PYZus{}wordnet\PYZus{}pos}\PY{p}{(}\PY{n}{tag}\PY{p}{)}\PY{p}{:}
  \PY{k}{if} \PY{n}{tag}\PY{o}{.}\PY{n}{startswith}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{J}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{:}
    \PY{k}{return} \PY{n}{wordnet}\PY{o}{.}\PY{n}{ADJ}
  \PY{k}{elif} \PY{n}{tag}\PY{o}{.}\PY{n}{startswith}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{V}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{:}
    \PY{k}{return} \PY{n}{wordnet}\PY{o}{.}\PY{n}{VERB}
  \PY{k}{elif} \PY{n}{tag}\PY{o}{.}\PY{n}{startswith}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{N}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{:}
    \PY{k}{return} \PY{n}{wordnet}\PY{o}{.}\PY{n}{NOUN}
  \PY{k}{elif} \PY{n}{tag}\PY{o}{.}\PY{n}{startswith}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{R}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{:}
    \PY{k}{return} \PY{n}{wordnet}\PY{o}{.}\PY{n}{ADV}
  \PY{k}{else}\PY{p}{:}
    \PY{k}{return} \PY{n}{wordnet}\PY{o}{.}\PY{n}{NOUN}


\PY{c+c1}{\PYZsh{} Tokenize the sentence}
\PY{k}{def} \PY{n+nf}{lemmatizer}\PY{p}{(}\PY{n}{string}\PY{p}{)}\PY{p}{:}
  \PY{n}{word\PYZus{}pos\PYZus{}tags} \PY{o}{=} \PY{n}{nltk}\PY{o}{.}\PY{n}{pos\PYZus{}tag}\PY{p}{(}\PY{n}{word\PYZus{}tokenize}\PY{p}{(}\PY{n}{string}\PY{p}{)}\PY{p}{)}  \PY{c+c1}{\PYZsh{} Get position tags}
  \PY{n}{a} \PY{o}{=} \PY{p}{[}\PY{n}{wl}\PY{o}{.}\PY{n}{lemmatize}\PY{p}{(}\PY{n}{tag}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{get\PYZus{}wordnet\PYZus{}pos}\PY{p}{(}\PY{n}{tag}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{p}{)} \PY{k}{for} \PY{n}{idx}\PY{p}{,} \PY{n}{tag} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{word\PYZus{}pos\PYZus{}tags}\PY{p}{)}\PY{p}{]}  \PY{c+c1}{\PYZsh{} Map the position tag and lemmatize the word/token}
  \PY{k}{return} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ }\PY{l+s+s2}{\PYZdq{}}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{n}{a}\PY{p}{)}


\PY{k}{def} \PY{n+nf}{finalpreprocess}\PY{p}{(}\PY{n}{text}\PY{p}{,} \PY{n}{stopwords\PYZus{}list}\PY{p}{)}\PY{p}{:}
  \PY{k}{return} \PY{n}{lemmatizer}\PY{p}{(}\PY{n}{preprocess}\PY{p}{(}\PY{n}{text}\PY{p}{,} \PY{n}{stopwords\PYZus{}list}\PY{p}{)}\PY{p}{)}


\PY{k}{def} \PY{n+nf}{make\PYZus{}include\PYZus{}list}\PY{p}{(}\PY{n}{df}\PY{p}{:}\PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{,} \PY{n}{columns}\PY{p}{:} \PY{n}{List}\PY{p}{[}\PY{n+nb}{str}\PY{p}{]}\PY{p}{)}\PY{p}{:}
  \PY{n}{words\PYZus{}to\PYZus{}include} \PY{o}{=}\PY{p}{[}\PY{p}{]}
  \PY{k}{for} \PY{n}{column} \PY{o+ow}{in} \PY{n}{columns}\PY{p}{:}
    \PY{n}{words\PYZus{}to\PYZus{}include} \PY{o}{+}\PY{o}{=} \PY{n}{df}\PY{p}{[}\PY{n}{column}\PY{p}{]}\PY{o}{.}\PY{n}{unique}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{tolist}\PY{p}{(}\PY{p}{)}
  \PY{k}{return} \PY{n+nb}{list}\PY{p}{(}\PY{n+nb}{set}\PY{p}{(}\PY{n}{words\PYZus{}to\PYZus{}include}\PY{p}{)}\PY{p}{)}


\PY{k}{def} \PY{n+nf}{get\PYZus{}observation\PYZus{}info}\PY{p}{(}\PY{n}{df}\PY{p}{:}\PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{,} \PY{n}{key}\PY{p}{:}\PY{n+nb}{str}\PY{p}{,} \PY{n}{column\PYZus{}year}\PY{p}{:}\PY{n}{Optional}\PY{p}{[}\PY{n}{Union}\PY{p}{[}\PY{n+nb}{str}\PY{p}{,} \PY{n+nb}{int}\PY{p}{]}\PY{p}{]}\PY{p}{,} \PY{n}{column\PYZus{}txt}\PY{p}{:}\PY{n+nb}{str}\PY{p}{)}\PY{p}{:}
  \PY{k}{def} \PY{n+nf}{wrap\PYZus{}by\PYZus{}word}\PY{p}{(}\PY{n}{s}\PY{p}{,} \PY{n}{n}\PY{p}{)}\PY{p}{:}
    \PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}returns a string where \PYZbs{}\PYZbs{}n is inserted between every n words\PYZsq{}\PYZsq{}\PYZsq{}}
    \PY{k}{if} \PY{n+nb}{isinstance}\PY{p}{(}\PY{n}{s}\PY{p}{,} \PY{n+nb}{str}\PY{p}{)}\PY{p}{:}
      \PY{n}{a} \PY{o}{=} \PY{n}{s}\PY{o}{.}\PY{n}{split}\PY{p}{(}\PY{p}{)}
      \PY{n}{ret} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZsq{}}
      \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{n+nb}{len}\PY{p}{(}\PY{n}{a}\PY{p}{)}\PY{p}{,} \PY{n}{n}\PY{p}{)}\PY{p}{:}
        \PY{n}{ret} \PY{o}{+}\PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ }\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{n}{a}\PY{p}{[}\PY{n}{i}\PY{p}{:}\PY{n}{i}\PY{o}{+}\PY{n}{n}\PY{p}{]}\PY{p}{)} \PY{o}{+} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{\PYZsq{}}

      \PY{k}{return} \PY{n}{ret}
    \PY{k}{return} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZdq{}}

  \PY{k}{if} \PY{n}{column\PYZus{}year}\PY{p}{:}
    \PY{k}{return} \PY{n}{df}\PY{p}{[}\PY{n}{key}\PY{p}{]} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ (}\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PY{n}{df}\PY{p}{[}\PY{n}{column\PYZus{}year}\PY{p}{]}\PY{o}{.}\PY{n}{apply}\PY{p}{(}\PY{k}{lambda} \PY{n}{x}\PY{p}{:} \PY{n+nb}{str}\PY{p}{(}\PY{n+nb}{int}\PY{p}{(}\PY{n}{x}\PY{p}{)}\PY{p}{)} \PY{k}{if} \PY{n+nb}{isinstance}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n+nb}{int}\PY{p}{)} \PY{o+ow}{or} \PY{n+nb}{isinstance}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n+nb}{str}\PY{p}{)} \PY{k}{else} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{) }\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{: }\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PY{n}{df}\PY{p}{[}\PY{n}{column\PYZus{}txt}\PY{p}{]}\PY{o}{.}\PY{n}{apply}\PY{p}{(}\PY{k}{lambda} \PY{n}{x}\PY{p}{:} \PY{n}{wrap\PYZus{}by\PYZus{}word}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{)}\PY{p}{)}
  \PY{k}{else}\PY{p}{:}
    \PY{k}{return} \PY{n}{df}\PY{p}{[}\PY{n}{key}\PY{p}{]} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{: }\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PY{n}{df}\PY{p}{[}\PY{n}{column\PYZus{}txt}\PY{p}{]}\PY{o}{.}\PY{n}{apply}\PY{p}{(}\PY{k}{lambda} \PY{n}{x}\PY{p}{:} \PY{n}{wrap\PYZus{}by\PYZus{}word}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{)}\PY{p}{)}


\PY{k}{def} \PY{n+nf}{label\PYZus{}point}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{y}\PY{p}{,} \PY{n}{val}\PY{p}{,} \PY{n}{ax}\PY{p}{,} \PY{n}{factor}\PY{p}{)}\PY{p}{:}
  \PY{n}{a} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{concat}\PY{p}{(}\PY{p}{\PYZob{}}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{x}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{y}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{y}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{val}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{val}\PY{p}{\PYZcb{}}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
  \PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{point} \PY{o+ow}{in} \PY{n}{a}\PY{o}{.}\PY{n}{iterrows}\PY{p}{(}\PY{p}{)}\PY{p}{:}
    \PY{n}{ax}\PY{o}{.}\PY{n}{text}\PY{p}{(}\PY{n}{point}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{+} \PY{l+m+mi}{1}\PY{o}{*}\PY{n}{factor}\PY{p}{,} \PY{n}{point}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{y}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{l+m+mi}{10}\PY{o}{*}\PY{n}{factor}\PY{p}{,} \PY{n+nb}{str}\PY{p}{(}\PY{n}{point}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{val}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}\PY{p}{)}


\PY{k}{def} \PY{n+nf}{visualise\PYZus{}clusters}\PY{p}{(}\PY{n}{df\PYZus{}2d\PYZus{}embedding}\PY{p}{,} \PY{n}{key}\PY{p}{:}\PY{n+nb}{str}\PY{p}{,} \PY{n}{column\PYZus{}year}\PY{p}{:}\PY{n}{Optional}\PY{p}{[}\PY{n}{Union}\PY{p}{[}\PY{n+nb}{str}\PY{p}{,} \PY{n+nb}{int}\PY{p}{]}\PY{p}{]}\PY{p}{,} \PY{n}{column\PYZus{}txt}\PY{p}{:}\PY{n+nb}{str}\PY{p}{,} \PY{n}{random\PYZus{}subsample}\PY{p}{:}\PY{n}{Optional}\PY{p}{[}\PY{n+nb}{float}\PY{p}{]}\PY{p}{,} \PY{n}{factor}\PY{o}{=}\PY{l+m+mi}{1} \PY{o}{/} \PY{l+m+mi}{200}\PY{p}{,} \PY{n}{base\PYZus{}size}\PY{o}{=}\PY{l+m+mi}{6}\PY{p}{)}\PY{p}{:}
  \PY{n}{\PYZus{}fig}\PY{p}{,} \PY{n}{\PYZus{}ax} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{n}{base\PYZus{}size}\PY{o}{*}\PY{l+m+mi}{4}\PY{p}{,}\PY{n}{base\PYZus{}size}\PY{o}{*}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{)}
  \PY{k}{if} \PY{n}{random\PYZus{}subsample}\PY{p}{:}
    \PY{n}{df\PYZus{}for\PYZus{}plot} \PY{o}{=} \PY{n}{df\PYZus{}2d\PYZus{}embedding}\PY{o}{.}\PY{n}{sample}\PY{p}{(}\PY{n}{frac}\PY{o}{=}\PY{n}{random\PYZus{}subsample}\PY{p}{)}
  \PY{k}{else}\PY{p}{:}
    \PY{n}{df\PYZus{}for\PYZus{}plot} \PY{o}{=} \PY{n}{df\PYZus{}2d\PYZus{}embedding}
  \PY{n}{df\PYZus{}for\PYZus{}plot}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{cluster}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{df\PYZus{}for\PYZus{}plot}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{cluster\PYZus{}kmeans}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{astype}\PY{p}{(}\PY{n+nb}{int}\PY{p}{)}
  \PY{n}{sns}\PY{o}{.}\PY{n}{scatterplot}\PY{p}{(}\PY{n}{data}\PY{o}{=}\PY{n}{df\PYZus{}for\PYZus{}plot}\PY{p}{,} \PY{n}{x}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{y}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{hue}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{cluster}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{style}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{cluster}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{legend}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{full}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{alpha}\PY{o}{=}\PY{l+m+mf}{0.9}\PY{p}{,} \PY{n}{s}\PY{o}{=}\PY{l+m+mi}{120}\PY{p}{,} \PY{n}{palette}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{deep}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{ax}\PY{o}{=}\PY{n}{\PYZus{}ax}\PY{p}{)}
  \PY{n}{label\PYZus{}point}\PY{p}{(}\PY{n}{df\PYZus{}for\PYZus{}plot}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{df\PYZus{}for\PYZus{}plot}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{get\PYZus{}observation\PYZus{}info}\PY{p}{(}\PY{n}{df\PYZus{}for\PYZus{}plot}\PY{p}{,} \PY{n}{key}\PY{p}{,} \PY{n}{column\PYZus{}year}\PY{p}{,} \PY{n}{column\PYZus{}txt}\PY{p}{)}\PY{p}{,} \PY{n}{\PYZus{}ax}\PY{p}{,} \PY{n}{factor}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \hypertarget{b.-class-for-augmenting-clustering}{%
\section{2b. Class for augmenting
clustering}\label{b.-class-for-augmenting-clustering}}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{167}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{class} \PY{n+nc}{Pipeline}\PY{p}{:}

  \PY{k}{def} \PY{n+nf+fm}{\PYZus{}\PYZus{}init\PYZus{}\PYZus{}}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,} \PY{n}{df}\PY{p}{:} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{,} \PY{n}{key}\PY{p}{:} \PY{n+nb}{str}\PY{p}{)}\PY{p}{:}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{df} \PY{o}{=} \PY{n}{df}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{df}\PY{o}{.}\PY{n}{reset\PYZus{}index}\PY{p}{(}\PY{n}{inplace}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
    \PY{k}{del} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{df}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{index}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{key} \PY{o}{=} \PY{n}{key}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{silhouette\PYZus{}scores}\PY{p}{:}\PY{n}{Optional}\PY{p}{[}\PY{n}{List}\PY{p}{[}\PY{n}{Tuple}\PY{p}{[}\PY{n+nb}{int}\PY{p}{,} \PY{n+nb}{float}\PY{p}{]}\PY{p}{]}\PY{p}{]} \PY{o}{=} \PY{k+kc}{None}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{column\PYZus{}year} \PY{o}{=} \PY{k+kc}{None}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{column\PYZus{}txt} \PY{o}{=} \PY{k+kc}{None}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{clusters\PYZus{}count}\PY{p}{:}\PY{n}{Optional}\PY{p}{[}\PY{n+nb}{int}\PY{p}{]} \PY{o}{=} \PY{k+kc}{None}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{df\PYZus{}tsne}\PY{p}{:}\PY{n}{Optional}\PY{p}{[}\PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{]} \PY{o}{=} \PY{k+kc}{None}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{df\PYZus{}pca}\PY{p}{:}\PY{n}{Optional}\PY{p}{[}\PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{]} \PY{o}{=} \PY{k+kc}{None}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{text\PYZus{}column}\PY{p}{:}\PY{n}{Optional}\PY{p}{[}\PY{n+nb}{str}\PY{p}{]} \PY{o}{=} \PY{k+kc}{None}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{clf} \PY{o}{=} \PY{k+kc}{None}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{df\PYZus{}metadata}\PY{p}{:} \PY{n}{Optional}\PY{p}{[}\PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{]} \PY{o}{=} \PY{k+kc}{None}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{explainer}\PY{p}{:}  \PY{n}{Optional}\PY{p}{[}\PY{n}{LimeTextExplainer}\PY{p}{]} \PY{o}{=} \PY{k+kc}{None}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{c} \PY{o}{=} \PY{k+kc}{None}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{stop\PYZus{}words} \PY{o}{=} \PY{k+kc}{None}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{words\PYZus{}to\PYZus{}include} \PY{o}{=} \PY{k+kc}{None}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{clusters}\PY{p}{:}\PY{n}{Optional}\PY{p}{[}\PY{n}{List}\PY{p}{[}\PY{n+nb}{int}\PY{p}{]}\PY{p}{]} \PY{o}{=} \PY{k+kc}{None}

    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{df}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{cluster\PYZus{}kmeans}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{NaN}
    \PY{n}{df\PYZus{}tsne}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{get\PYZus{}TSNE\PYZus{}and\PYZus{}PCA\PYZus{}embeddings}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{df}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{key}\PY{p}{,} \PY{l+m+mf}{.30}\PY{p}{,} \PY{k+kc}{False}\PY{p}{)}

    \PY{n}{fig}\PY{p}{,} \PY{n}{ax} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{12} \PY{o}{*} \PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{5} \PY{o}{*} \PY{l+m+mi}{2}\PY{p}{)}\PY{p}{)}
    \PY{n}{ax}\PY{o}{.}\PY{n}{set\PYZus{}title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{TSNE}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    \PY{n}{sns}\PY{o}{.}\PY{n}{scatterplot}\PY{p}{(}\PY{n}{data}\PY{o}{=}\PY{n}{df\PYZus{}tsne}\PY{p}{,} \PY{n}{x}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{y}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{hue}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{cluster}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{style}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{cluster}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{legend}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{full}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{alpha}\PY{o}{=}\PY{l+m+mf}{0.9}\PY{p}{,} \PY{n}{palette}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{deep}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{s}\PY{o}{=}\PY{l+m+mi}{100}\PY{p}{,} \PY{n}{ax}\PY{o}{=}\PY{n}{ax}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} ax[1].set\PYZus{}title(\PYZsq{}PCA\PYZsq{})}
    \PY{c+c1}{\PYZsh{} sns.scatterplot(data=self.df\PYZus{}pca, x=\PYZsq{}x1\PYZsq{}, y=\PYZsq{}x2\PYZsq{}, hue=\PYZsq{}cluster\PYZsq{}, style=\PYZsq{}cluster\PYZsq{}, legend=\PYZdq{}full\PYZdq{}, alpha=0.9, palette=\PYZdq{}deep\PYZdq{}, s=100, ax=ax[1])}

  \PY{k}{def} \PY{n+nf}{plot\PYZus{}silhouette}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,} \PY{n}{max\PYZus{}clusters\PYZus{}count}\PY{p}{:}\PY{n+nb}{int}\PY{p}{,} \PY{n}{random\PYZus{}subsample}\PY{p}{:}\PY{n}{Optional}\PY{p}{[}\PY{n+nb}{float}\PY{p}{]}\PY{p}{,} \PY{n}{reset}\PY{p}{:}\PY{n+nb}{bool}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}\PY{p}{:}
    \PY{k}{if} \PY{n}{reset} \PY{o+ow}{or} \PY{o+ow}{not} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{silhouette\PYZus{}scores}\PY{p}{:}
      \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{silhouette\PYZus{}scores} \PY{o}{=} \PY{p}{[}\PY{p}{]}
      \PY{c+c1}{\PYZsh{} sil = []}
      \PY{c+c1}{\PYZsh{} kl = []}
      \PY{k}{for} \PY{n}{k} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{max\PYZus{}clusters\PYZus{}count} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{:}
        \PY{n}{df\PYZus{}subsample} \PY{o}{=} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{df}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{df}\PY{o}{.}\PY{n}{columns} \PY{o}{!=} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{key}\PY{p}{)} \PY{o}{\PYZam{}} \PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{df}\PY{o}{.}\PY{n}{columns} \PY{o}{!=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{cluster\PYZus{}kmeans}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{]}
        \PY{k}{if} \PY{n}{random\PYZus{}subsample}\PY{p}{:}
          \PY{n}{df\PYZus{}subsample} \PY{o}{=} \PY{n}{df\PYZus{}subsample}\PY{o}{.}\PY{n}{sample}\PY{p}{(}\PY{n}{frac}\PY{o}{=}\PY{n}{random\PYZus{}subsample}\PY{p}{)}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{processing }\PY{l+s+si}{\PYZob{}}\PY{n}{k}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{ clusters}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
        \PY{n}{kmeans2} \PY{o}{=} \PY{n}{KMeans}\PY{p}{(}\PY{n}{n\PYZus{}clusters} \PY{o}{=} \PY{n}{k}\PY{p}{)}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{df\PYZus{}subsample}\PY{p}{)}
        \PY{n}{labels} \PY{o}{=} \PY{n}{kmeans2}\PY{o}{.}\PY{n}{labels\PYZus{}}
        \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{silhouette\PYZus{}scores}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{p}{(}\PY{n}{k}\PY{p}{,} \PY{n}{silhouette\PYZus{}score}\PY{p}{(}\PY{n}{df\PYZus{}subsample}\PY{p}{,} \PY{n}{labels}\PY{p}{)}\PY{p}{)}\PY{p}{)}
        \PY{c+c1}{\PYZsh{} sil.append()}
        \PY{c+c1}{\PYZsh{} kl.append(k)}

    \PY{n}{kl} \PY{o}{=} \PY{p}{[}\PY{n}{x}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]} \PY{k}{for} \PY{n}{x} \PY{o+ow}{in} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{silhouette\PYZus{}scores}\PY{p}{]}
    \PY{n}{sil} \PY{o}{=} \PY{p}{[}\PY{n}{x}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]} \PY{k}{for} \PY{n}{x} \PY{o+ow}{in} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{silhouette\PYZus{}scores}\PY{p}{]}
    \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{32}\PY{p}{,} \PY{l+m+mi}{16}\PY{p}{)}\PY{p}{)}
    \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{kl}\PY{p}{,} \PY{n}{sil}\PY{p}{)}
    \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Silhouette Score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Clusters count}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} self.silhouette\PYZus{}scores = [x for x in zip(kl, sil)]}
    \PY{k}{for} \PY{n}{a}\PY{p}{,} \PY{n}{b} \PY{o+ow}{in} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{silhouette\PYZus{}scores}\PY{p}{:}
      \PY{n}{plt}\PY{o}{.}\PY{n}{text}\PY{p}{(}\PY{n}{a}\PY{p}{,} \PY{n}{b}\PY{p}{,} \PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+si}{\PYZob{}}\PY{n+nb}{int}\PY{p}{(}\PY{n}{b}\PY{o}{*}\PY{l+m+mi}{10000}\PY{p}{)}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{ (}\PY{l+s+si}{\PYZob{}}\PY{n}{a}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}

  \PY{k}{def} \PY{n+nf}{fit}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,} \PY{n}{clusters\PYZus{}count}\PY{p}{:} \PY{n+nb}{int}\PY{p}{)}\PY{p}{:}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{clusters\PYZus{}count} \PY{o}{=} \PY{n}{clusters\PYZus{}count}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{df} \PY{o}{=} \PY{n}{k\PYZus{}means}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{df}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{key}\PY{p}{,} \PY{n}{clusters\PYZus{}count}\PY{p}{)}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{df\PYZus{}tsne}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{get\PYZus{}TSNE\PYZus{}and\PYZus{}PCA\PYZus{}embeddings}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{df}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{key}\PY{p}{,} \PY{k+kc}{None}\PY{p}{,} \PY{k+kc}{False}\PY{p}{)}

    \PY{n}{fig}\PY{p}{,} \PY{n}{ax} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{12} \PY{o}{*} \PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{5} \PY{o}{*} \PY{l+m+mi}{2}\PY{p}{)}\PY{p}{)}
    \PY{n}{ax}\PY{o}{.}\PY{n}{set\PYZus{}title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{TSNE}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}  \PY{c+c1}{\PYZsh{} [0]}
    \PY{n}{sns}\PY{o}{.}\PY{n}{scatterplot}\PY{p}{(}\PY{n}{data}\PY{o}{=}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{df\PYZus{}tsne}\PY{p}{,} \PY{n}{x}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{y}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{hue}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{cluster}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{style}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{cluster}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{legend}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{full}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{alpha}\PY{o}{=}\PY{l+m+mf}{0.9}\PY{p}{,} \PY{n}{palette}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{deep}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{s}\PY{o}{=}\PY{l+m+mi}{100}\PY{p}{,} \PY{n}{ax}\PY{o}{=}\PY{n}{ax}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} ax[1].set\PYZus{}title(\PYZsq{}PCA\PYZsq{})}
    \PY{c+c1}{\PYZsh{} sns.scatterplot(data=self.df\PYZus{}pca, x=\PYZsq{}x1\PYZsq{}, y=\PYZsq{}x2\PYZsq{}, hue=\PYZsq{}cluster\PYZsq{}, style=\PYZsq{}cluster\PYZsq{}, legend=\PYZdq{}full\PYZdq{}, alpha=0.9, palette=\PYZdq{}deep\PYZdq{}, s=100, ax=ax[1])}

  \PY{k}{def} \PY{n+nf}{init\PYZus{}metadata}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,} \PY{n}{df\PYZus{}metadata}\PY{p}{:} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{)}\PY{p}{:}
    \PY{k}{assert} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{key} \PY{o+ow}{in} \PY{n}{df\PYZus{}metadata}\PY{o}{.}\PY{n}{columns}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{df\PYZus{}metadata} \PY{o}{=} \PY{n}{df\PYZus{}metadata}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{df\PYZus{}metadata}\PY{p}{[}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{key}\PY{p}{]}\PY{o}{.}\PY{n}{apply}\PY{p}{(}\PY{k}{lambda} \PY{n}{x}\PY{p}{:} \PY{n}{x} \PY{o+ow}{in} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{df}\PY{p}{[}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{key}\PY{p}{]}\PY{o}{.}\PY{n}{tolist}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{,} \PY{p}{]}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{df\PYZus{}metadata}\PY{o}{.}\PY{n}{reset\PYZus{}index}\PY{p}{(}\PY{n}{inplace}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
    \PY{k}{del} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{df\PYZus{}metadata}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{index}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
    \PY{k}{if} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{cluster\PYZus{}kmeans}\PY{l+s+s1}{\PYZsq{}} \PY{o+ow}{in} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{df\PYZus{}metadata}\PY{o}{.}\PY{n}{columns}\PY{p}{:}
      \PY{k}{del} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{df\PYZus{}metadata}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{cluster\PYZus{}kmeans}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
    \PY{c+c1}{\PYZsh{} self.df\PYZus{}metadata.rename(columns=\PYZob{}self.key : \PYZsq{}ID\PYZsq{}\PYZcb{}, inplace=True)}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{df\PYZus{}metadata} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{merge}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{df}\PY{p}{[}\PY{p}{[}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{key}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{cluster\PYZus{}kmeans}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{df\PYZus{}metadata}\PY{p}{,} \PY{n}{on}\PY{o}{=}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{key}\PY{p}{)}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{df\PYZus{}metadata} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{merge}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{df\PYZus{}tsne}\PY{p}{[}\PY{p}{[}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{key}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{df\PYZus{}metadata}\PY{p}{,} \PY{n}{on}\PY{o}{=}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{key}\PY{p}{)}

    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{clusters} \PY{o}{=} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{df\PYZus{}metadata}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{cluster\PYZus{}kmeans}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{astype}\PY{p}{(}\PY{n+nb}{str}\PY{p}{)}\PY{o}{.}\PY{n}{unique}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{tolist}\PY{p}{(}\PY{p}{)}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{clusters}\PY{o}{.}\PY{n}{sort}\PY{p}{(}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{clusters= }\PY{l+s+si}{\PYZob{}}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{clusters}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}

  \PY{k}{def} \PY{n+nf}{visualise\PYZus{}clustering}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,} \PY{n}{column\PYZus{}year}\PY{p}{:}\PY{n}{Optional}\PY{p}{[}\PY{n}{Union}\PY{p}{[}\PY{n+nb}{str}\PY{p}{,} \PY{n+nb}{int}\PY{p}{]}\PY{p}{]}\PY{p}{,} \PY{n}{column\PYZus{}txt}\PY{p}{:}\PY{n+nb}{str}\PY{p}{,} \PY{n}{random\PYZus{}subsample}\PY{p}{:}\PY{n}{Optional}\PY{p}{[}\PY{n+nb}{float}\PY{p}{]}\PY{p}{,} \PY{n}{size}\PY{p}{:}\PY{n+nb}{int}\PY{o}{=}\PY{l+m+mi}{7}\PY{p}{)}\PY{p}{:}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{column\PYZus{}year} \PY{o}{=} \PY{n}{column\PYZus{}year}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{column\PYZus{}txt} \PY{o}{=} \PY{n}{column\PYZus{}txt}
    \PY{k}{if} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{clusters\PYZus{}count} \PY{o+ow}{and} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{df\PYZus{}metadata} \PY{o+ow}{is} \PY{o+ow}{not} \PY{k+kc}{None}\PY{p}{:}
      \PY{n}{visualise\PYZus{}clusters}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{df\PYZus{}metadata}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{key}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{column\PYZus{}year}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{column\PYZus{}txt}\PY{p}{,} \PY{n}{random\PYZus{}subsample}\PY{p}{,} \PY{n}{base\PYZus{}size}\PY{o}{=}\PY{n}{size}\PY{o}{*}\PY{l+m+mi}{6}\PY{p}{,} \PY{n}{factor}\PY{o}{=}\PY{l+m+mi}{1}\PY{o}{/}\PY{n}{size} \PY{o}{*} \PY{l+m+mi}{1}\PY{o}{/}\PY{l+m+mi}{200}\PY{p}{)}

  \PY{k}{def} \PY{n+nf}{explain}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,} \PY{n}{text\PYZus{}column}\PY{p}{:}\PY{n+nb}{str}\PY{p}{,} \PY{n}{features\PYZus{}count}\PY{p}{:}\PY{n+nb}{int}\PY{p}{,}
      \PY{n}{stop\PYZus{}words}\PY{p}{:} \PY{n}{Optional}\PY{p}{[}\PY{n}{List}\PY{p}{[}\PY{n+nb}{str}\PY{p}{]}\PY{p}{]} \PY{o}{=} \PY{k+kc}{None}\PY{p}{,} \PY{n}{words\PYZus{}to\PYZus{}include}\PY{p}{:} \PY{n}{Optional}\PY{p}{[}\PY{n}{List}\PY{p}{[}\PY{n+nb}{str}\PY{p}{]}\PY{p}{]} \PY{o}{=} \PY{k+kc}{None}\PY{p}{)}\PY{p}{:}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{text\PYZus{}column} \PY{o}{=} \PY{n}{text\PYZus{}column}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{stop\PYZus{}words} \PY{o}{=} \PY{n}{stop\PYZus{}words}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{words\PYZus{}to\PYZus{}include} \PY{o}{=} \PY{n}{words\PYZus{}to\PYZus{}include}

    \PY{n}{train}\PY{p}{,} \PY{n}{test}\PY{p}{,} \PY{n}{train\PYZus{}labels}\PY{p}{,} \PY{n}{test\PYZus{}labels} \PY{o}{=} \PY{n}{train\PYZus{}test\PYZus{}split}\PY{p}{(}
      \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{df\PYZus{}metadata}\PY{p}{[}\PY{n}{text\PYZus{}column}\PY{p}{]}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{df\PYZus{}metadata}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{cluster\PYZus{}kmeans}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{test\PYZus{}size}\PY{o}{=}\PY{l+m+mf}{.2}\PY{p}{,} \PY{n}{shuffle}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
    \PY{n}{train\PYZus{}labels} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{train\PYZus{}labels}\PY{p}{)}
    \PY{n}{test\PYZus{}labels} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{test\PYZus{}labels}\PY{p}{)}
    \PY{n}{vectorizer} \PY{o}{=} \PY{n}{TfidfVectorizer}\PY{p}{(}\PY{n}{max\PYZus{}features}\PY{o}{=}\PY{n}{features\PYZus{}count}\PY{p}{,} \PY{n}{stop\PYZus{}words}\PY{o}{=}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{stop\PYZus{}words}\PY{p}{,} \PY{n}{min\PYZus{}df}\PY{o}{=}\PY{l+m+mi}{5}\PY{p}{,} \PY{n}{max\PYZus{}df}\PY{o}{=}\PY{l+m+mf}{.05}\PY{p}{,} \PY{n}{ngram\PYZus{}range}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{5}\PY{p}{)}\PY{p}{)}
    \PY{n}{vectorizer}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{train}\PY{p}{)}
    \PY{n}{top\PYZus{}features} \PY{o}{=} \PY{n}{vectorizer}\PY{o}{.}\PY{n}{vocabulary\PYZus{}}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Explanations will use: }\PY{l+s+si}{\PYZob{}}\PY{p}{[}\PY{n}{x} \PY{k}{for} \PY{n}{x} \PY{o+ow}{in} \PY{n}{top\PYZus{}features}\PY{o}{.}\PY{n}{keys}\PY{p}{(}\PY{p}{)}\PY{p}{]}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{k}{for} \PY{n}{index}\PY{p}{,} \PY{n}{feature} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{words\PYZus{}to\PYZus{}include}\PY{p}{)}\PY{p}{:}
      \PY{n}{top\PYZus{}features}\PY{p}{[}\PY{n}{feature}\PY{p}{]} \PY{o}{=} \PY{n}{features\PYZus{}count} \PY{o}{+} \PY{n}{index}

    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{vectorizer} \PY{o}{=} \PY{n}{TfidfVectorizer}\PY{p}{(}\PY{n}{vocabulary}\PY{o}{=}\PY{n}{top\PYZus{}features}\PY{p}{)}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{vectorizer}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{train}\PY{p}{)}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{clf} \PY{o}{=} \PY{n}{DecisionTreeClassifier}\PY{p}{(}\PY{p}{)}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{clf}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{vectorizer}\PY{o}{.}\PY{n}{transform}\PY{p}{(}\PY{n}{train}\PY{p}{)}\PY{p}{,} \PY{n}{train\PYZus{}labels}\PY{p}{)}
    \PY{n}{predict\PYZus{}fn} \PY{o}{=} \PY{k}{lambda} \PY{n}{x}\PY{p}{:} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{clf}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{vectorizer}\PY{o}{.}\PY{n}{transform}\PY{p}{(}\PY{n}{x}\PY{p}{)}\PY{p}{)}

    \PY{n}{preds\PYZus{}train} \PY{o}{=} \PY{n}{predict\PYZus{}fn}\PY{p}{(}\PY{n}{train}\PY{p}{)}
    \PY{n}{preds\PYZus{}test} \PY{o}{=} \PY{n}{predict\PYZus{}fn}\PY{p}{(}\PY{n}{test}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train accuracy}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{train\PYZus{}labels}\PY{p}{,} \PY{n}{preds\PYZus{}train}\PY{p}{)}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test accuracy}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{test\PYZus{}labels}\PY{p}{,} \PY{n}{preds\PYZus{}test}\PY{p}{)}\PY{p}{)}

    \PY{n+nb}{print}\PY{p}{(}\PY{n}{classification\PYZus{}report}\PY{p}{(}\PY{n}{test\PYZus{}labels}\PY{p}{,} \PY{n}{preds\PYZus{}test}\PY{p}{)}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Confusion Matrix:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{confusion\PYZus{}matrix}\PY{p}{(}\PY{n}{test\PYZus{}labels}\PY{p}{,} \PY{n}{preds\PYZus{}test}\PY{p}{)}\PY{p}{)}

    \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{3}\PY{o}{*}\PY{l+m+mi}{16}\PY{p}{,} \PY{l+m+mi}{2}\PY{o}{*}\PY{l+m+mi}{8}\PY{p}{)}\PY{p}{)}
    \PY{n}{tree}\PY{o}{.}\PY{n}{plot\PYZus{}tree}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{clf}\PY{p}{,} \PY{n}{feature\PYZus{}names} \PY{o}{=} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{vectorizer}\PY{o}{.}\PY{n}{get\PYZus{}feature\PYZus{}names}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{class\PYZus{}names} \PY{o}{=} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{clusters}\PY{p}{,} \PY{n}{max\PYZus{}depth}\PY{o}{=}\PY{l+m+mi}{5}\PY{p}{,} \PY{n}{fontsize}\PY{o}{=}\PY{l+m+mi}{9}\PY{p}{,} \PY{n}{proportion}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,} \PY{n}{filled}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,} \PY{n}{rounded}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}

  \PY{k}{def} \PY{n+nf}{lime\PYZus{}example}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,} \PY{n}{cluster}\PY{p}{:}\PY{n}{Optional}\PY{p}{[}\PY{n}{Union}\PY{p}{[}\PY{n+nb}{int}\PY{p}{,} \PY{n+nb}{str}\PY{p}{]}\PY{p}{]}\PY{p}{)}\PY{p}{:}
    \PY{k}{if} \PY{o+ow}{not} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{explainer}\PY{p}{:}
      \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{explainer} \PY{o}{=} \PY{n}{LimeTextExplainer}\PY{p}{(}\PY{n}{class\PYZus{}names}\PY{o}{=}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{clf}\PY{o}{.}\PY{n}{classes\PYZus{}}\PY{p}{)}
      \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{c} \PY{o}{=} \PY{n}{make\PYZus{}pipeline}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{vectorizer}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{clf}\PY{p}{)}

    \PY{k}{if} \PY{n}{cluster}\PY{p}{:}
      \PY{n}{random\PYZus{}row} \PY{o}{=} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{df\PYZus{}metadata}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{df\PYZus{}metadata}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{cluster\PYZus{}kmeans}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{astype}\PY{p}{(}\PY{n+nb}{str}\PY{p}{)} \PY{o}{==} \PY{n+nb}{str}\PY{p}{(}\PY{n}{cluster}\PY{p}{)}\PY{p}{,} \PY{p}{]}\PY{o}{.}\PY{n}{sample}\PY{p}{(}\PY{n}{n} \PY{o}{=} \PY{l+m+mi}{1}\PY{p}{)}
    \PY{k}{else}\PY{p}{:}
      \PY{n}{random\PYZus{}row} \PY{o}{=} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{df\PYZus{}metadata}\PY{o}{.}\PY{n}{sample}\PY{p}{(}\PY{n}{n} \PY{o}{=} \PY{l+m+mi}{1}\PY{p}{)}

    \PY{n}{\PYZus{}cluster\PYZus{}kmeans} \PY{o}{=} \PY{n}{random\PYZus{}row}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{cluster\PYZus{}kmeans}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{tolist}\PY{p}{(}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{\PYZus{}text\PYZus{}to\PYZus{}expl} \PY{o}{=} \PY{n}{random\PYZus{}row}\PY{p}{[}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{text\PYZus{}column}\PY{p}{]}\PY{o}{.}\PY{n}{tolist}\PY{p}{(}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Cluster= }\PY{l+s+si}{\PYZob{}}\PY{n}{\PYZus{}cluster\PYZus{}kmeans}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, text= }\PY{l+s+si}{\PYZob{}}\PY{n}{\PYZus{}text\PYZus{}to\PYZus{}expl}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{explainer}\PY{o}{.}\PY{n}{explain\PYZus{}instance}\PY{p}{(}\PY{n}{\PYZus{}text\PYZus{}to\PYZus{}expl}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{c}\PY{o}{.}\PY{n}{predict\PYZus{}proba}\PY{p}{,} \PY{n}{num\PYZus{}features}\PY{o}{=}\PY{l+m+mi}{5}\PY{p}{,} \PY{n}{labels}\PY{o}{=}\PY{p}{(}\PY{n}{\PYZus{}cluster\PYZus{}kmeans}\PY{p}{,}\PY{p}{)}\PY{p}{)}\PY{o}{.}\PY{n}{show\PYZus{}in\PYZus{}notebook}\PY{p}{(}\PY{p}{)}

  \PY{k}{def} \PY{n+nf}{word\PYZus{}cloud}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,} \PY{n}{example\PYZus{}presenting\PYZus{}fun}\PY{p}{:}\PY{n}{Optional}\PY{p}{,} \PY{n}{present\PYZus{}lime}\PY{p}{:}\PY{n+nb}{bool}\PY{p}{)}\PY{p}{:}
    \PY{k}{for} \PY{n}{cluster} \PY{o+ow}{in} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{clusters}\PY{p}{:}
      \PY{n+nb}{print} \PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{cluster= }\PY{l+s+si}{\PYZob{}}\PY{n}{cluster}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
      \PY{k}{if} \PY{n}{example\PYZus{}presenting\PYZus{}fun}\PY{p}{:}
        \PY{n}{examples\PYZus{}count} \PY{o}{=} \PY{l+m+mi}{7}
        \PY{n}{fig}\PY{p}{,} \PY{n}{axs} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{examples\PYZus{}count}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{50}\PY{p}{,} \PY{l+m+mi}{50}\PY{p}{)}\PY{p}{)} \PY{c+c1}{\PYZsh{}\PYZsh{}\PYZsh{} making subplot}
        \PY{n}{example\PYZus{}presenting\PYZus{}fun}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{df\PYZus{}metadata}\PY{p}{,} \PY{n+nb}{str}\PY{p}{(}\PY{n}{cluster}\PY{p}{)}\PY{p}{,} \PY{n}{examples\PYZus{}count}\PY{p}{,} \PY{n}{axs}\PY{p}{)}

      \PY{k}{if} \PY{n}{present\PYZus{}lime}\PY{p}{:}
        \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{lime\PYZus{}example}\PY{p}{(}\PY{n}{cluster}\PY{p}{)}

      \PY{c+c1}{\PYZsh{} Start with one review:}
      \PY{c+c1}{\PYZsh{} print(self.df\PYZus{}nodes\PYZus{}for\PYZus{}xai.loc[self.df\PYZus{}nodes\PYZus{}for\PYZus{}xai[\PYZsq{}cluster\PYZus{}kmeans\PYZsq{}].astype(str) == cluster, self.text\PYZus{}column].tolist())}
      \PY{n}{words} \PY{o}{=} \PY{n}{word\PYZus{}tokenize}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ }\PY{l+s+s2}{\PYZdq{}}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{df\PYZus{}metadata}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{df\PYZus{}metadata}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{cluster\PYZus{}kmeans}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{astype}\PY{p}{(}\PY{n+nb}{str}\PY{p}{)} \PY{o}{==} \PY{n}{cluster}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{text\PYZus{}column}\PY{p}{]}\PY{o}{.}\PY{n}{tolist}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{)}
      \PY{n}{words} \PY{o}{=} \PY{p}{[}\PY{n}{w} \PY{k}{for} \PY{n}{w} \PY{o+ow}{in} \PY{n}{words} \PY{k}{if} \PY{o+ow}{not} \PY{n}{w}\PY{o}{.}\PY{n}{lower}\PY{p}{(}\PY{p}{)} \PY{o+ow}{in} \PY{n+nb}{list}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{stop\PYZus{}words}\PY{p}{)}\PY{p}{]}

      \PY{c+c1}{\PYZsh{} Create and generate a word cloud image:}
      \PY{c+c1}{\PYZsh{} text = \PYZdq{} \PYZdq{}.join(words)}

      \PY{n}{vectorizer} \PY{o}{=} \PY{n}{TfidfVectorizer}\PY{p}{(}\PY{n}{max\PYZus{}features}\PY{o}{=}\PY{l+m+mi}{1000}\PY{p}{,} \PY{n}{stop\PYZus{}words}\PY{o}{=}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{stop\PYZus{}words}\PY{p}{,} \PY{n}{min\PYZus{}df}\PY{o}{=}\PY{l+m+mi}{5}\PY{p}{,} \PY{n}{max\PYZus{}df}\PY{o}{=}\PY{l+m+mf}{.20}\PY{p}{,} \PY{n}{ngram\PYZus{}range}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{5}\PY{p}{)}\PY{p}{)}
      \PY{n}{response} \PY{o}{=} \PY{n}{vectorizer}\PY{o}{.}\PY{n}{fit\PYZus{}transform}\PY{p}{(}\PY{n}{words}\PY{p}{)}
      \PY{n}{df\PYZus{}tfidf\PYZus{}sklearn} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{response}\PY{o}{.}\PY{n}{toarray}\PY{p}{(}\PY{p}{)}\PY{p}{,}\PY{n}{columns}\PY{o}{=}\PY{n}{vectorizer}\PY{o}{.}\PY{n}{get\PYZus{}feature\PYZus{}names}\PY{p}{(}\PY{p}{)}\PY{p}{)}
      \PY{n}{tf\PYZus{}idf\PYZus{}counter} \PY{o}{=} \PY{n}{df\PYZus{}tfidf\PYZus{}sklearn}\PY{o}{.}\PY{n}{T}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}

      \PY{c+c1}{\PYZsh{} print(text)}
      \PY{n}{wordcloud} \PY{o}{=} \PY{n}{WordCloud}\PY{p}{(}\PY{n}{background\PYZus{}color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{white}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{o}{.}\PY{n}{generate\PYZus{}from\PYZus{}frequencies}\PY{p}{(}\PY{n}{tf\PYZus{}idf\PYZus{}counter}\PY{p}{)}

      \PY{c+c1}{\PYZsh{} Display the generated image:}
      \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{15}\PY{p}{,}\PY{l+m+mi}{15}\PY{p}{)}\PY{p}{)}
      \PY{n}{plt}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{wordcloud}\PY{p}{,} \PY{n}{interpolation}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{bilinear}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
      \PY{n}{plt}\PY{o}{.}\PY{n}{axis}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{off}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
      \PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \hypertarget{load-data-prepare}{%
\section{3. Load data \& prepare}\label{load-data-prepare}}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{7}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{input\PYZus{}dir} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{notebooks/xai\PYZhy{}survey/images}\PY{l+s+s1}{\PYZsq{}}
\PY{n}{glob\PYZus{}dir} \PY{o}{=} \PY{n}{input\PYZus{}dir} \PY{o}{+} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{/*.jpg}\PY{l+s+s1}{\PYZsq{}}
\PY{n}{temp}  \PY{o}{=} \PY{n}{glob}\PY{o}{.}\PY{n}{glob}\PY{p}{(}\PY{n}{glob\PYZus{}dir}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{temp}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
44441
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{8}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} process all images}
\PY{n}{selected\PYZus{}images}\PY{o}{=} \PY{n}{temp}\PY{c+c1}{\PYZsh{}[0:1000]}
\PY{n}{paths} \PY{o}{=} \PY{p}{[}\PY{n}{file} \PY{k}{for} \PY{n}{file} \PY{o+ow}{in} \PY{n}{selected\PYZus{}images}\PY{p}{]}
\PY{n}{images} \PY{o}{=} \PY{p}{[}\PY{n}{cv2}\PY{o}{.}\PY{n}{resize}\PY{p}{(}\PY{n}{cv2}\PY{o}{.}\PY{n}{imread}\PY{p}{(}\PY{n}{file}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{128}\PY{p}{,} \PY{l+m+mi}{128}\PY{p}{)}\PY{p}{)} \PY{k}{for} \PY{n}{file} \PY{o+ow}{in} \PY{n}{selected\PYZus{}images}\PY{p}{]}
\PY{n}{images} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{float32}\PY{p}{(}\PY{n}{images}\PY{p}{)}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{images}\PY{p}{)}\PY{p}{,}\PY{n}{images}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,}\PY{n}{images}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,}\PY{n}{images}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{]}\PY{p}{)}\PY{o}{/}\PY{l+m+mi}{255}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{n}{images}\PY{o}{.}\PY{n}{shape}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{images}\PY{p}{[}\PY{l+m+mi}{10}\PY{p}{]}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
(44441, 128, 128, 3)
    \end{Verbatim}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{8}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
<matplotlib.image.AxesImage at 0x7f80dcbd9e20>
\end{Verbatim}
\end{tcolorbox}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_15_2.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{8}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} image size}
\PY{l+m+mi}{128} \PY{o}{*} \PY{l+m+mi}{128} \PY{o}{*} \PY{l+m+mi}{3}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{8}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
49152
\end{Verbatim}
\end{tcolorbox}
        
    \hypertarget{b.-calculate-images-embeddings}{%
\section{3b. Calculate images
embeddings}\label{b.-calculate-images-embeddings}}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{9}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Getting embedded data}
\PY{c+c1}{\PYZsh{}\PYZsh{} embedding}
\PY{n}{model} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{keras}\PY{o}{.}\PY{n}{applications}\PY{o}{.}\PY{n}{MobileNetV2}\PY{p}{(}\PY{n}{include\PYZus{}top} \PY{o}{=} \PY{k+kc}{False}\PY{p}{,} \PY{n}{weights}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{imagenet}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{input\PYZus{}shape}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{128}\PY{p}{,} \PY{l+m+mi}{128}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{)}\PY{p}{)}
\PY{n}{predictions} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{images}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{128}\PY{p}{,} \PY{l+m+mi}{128}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{)}\PY{p}{)} \PY{c+c1}{\PYZsh{}\PYZsh{} representation of image to reduce size}
\PY{n}{pred\PYZus{}images} \PY{o}{=} \PY{n}{predictions}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}\PY{n}{images}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)} \PY{c+c1}{\PYZsh{}\PYZsh{} reshape}
\PY{n}{pred\PYZus{}images}\PY{o}{.}\PY{n}{shape}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
2022-05-14 19:41:05.523865: I
tensorflow/stream\_executor/cuda/cuda\_gpu\_executor.cc:936] successful NUMA node
read from SysFS had negative value (-1), but there must be at least one NUMA
node, so returning NUMA node zero
2022-05-14 19:41:05.537132: W
tensorflow/stream\_executor/platform/default/dso\_loader.cc:64] Could not load
dynamic library 'libcusolver.so.11'; dlerror: libcusolver.so.11: cannot open
shared object file: No such file or directory; LD\_LIBRARY\_PATH:
/home/mmozolewski/.local/lib/python3.8/site-
packages/cv2/../../lib64:/usr/local/cuda-11.0/lib64:
2022-05-14 19:41:05.539741: W
tensorflow/core/common\_runtime/gpu/gpu\_device.cc:1850] Cannot dlopen some GPU
libraries. Please make sure the missing libraries mentioned above are installed
properly if you would like to use GPU. Follow the guide at
https://www.tensorflow.org/install/gpu for how to download and setup the
required libraries for your platform.
Skipping registering GPU devices{\ldots}
2022-05-14 19:41:05.540432: I tensorflow/core/platform/cpu\_feature\_guard.cc:151]
This TensorFlow binary is optimized with oneAPI Deep Neural Network Library
(oneDNN) to use the following CPU instructions in performance-critical
operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate
compiler flags.
2022-05-14 19:41:06.014596: W
tensorflow/core/framework/cpu\_allocator\_impl.cc:82] Allocation of 8737456128
exceeds 10\% of free system memory.
    \end{Verbatim}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{9}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
(44441, 20480)
\end{Verbatim}
\end{tcolorbox}
        
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{10}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{pred\PYZus{}images}\PY{p}{[}\PY{p}{:}\PY{l+m+mi}{10}\PY{p}{]}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{10}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
      0         1      2        3         4         5         6         7      \textbackslash{}
0  0.000000  0.000000    0.0  0.00000  0.000000  3.490847  1.975876  0.203021
1  0.000000  0.000000    0.0  0.00000  1.097074  0.000000  0.000000  0.000000
2  0.000000  0.000000    0.0  0.00000  0.000000  0.000000  0.000000  0.000000
3  0.000000  0.000000    0.0  0.00000  1.674848  0.000000  0.000000  0.000000
4  0.000000  0.000000    0.0  0.00000  0.000000  0.000000  0.000000  0.000000
5  0.611750  0.000000    0.0  1.41979  4.280862  0.000000  0.000000  0.000000
6  0.226754  0.184644    0.0  0.00000  0.000000  0.000000  0.000000  0.000000
7  0.000000  0.000000    0.0  0.00000  1.509722  0.000000  0.000000  0.000000
8  0.000000  0.000000    0.0  0.00000  0.000000  0.000000  0.000000  0.000000
9  0.000000  0.000000    0.0  0.00000  1.239510  0.000000  0.000000  0.000000

   8         9      {\ldots}     20470     20471     20472     20473     20474  \textbackslash{}
0    0.0  4.109615  {\ldots}  0.000000  0.000000  0.000000  0.000000  0.794228
1    0.0  1.013652  {\ldots}  0.194866  0.266604  0.155169  0.000000  0.000000
2    0.0  0.000000  {\ldots}  0.023009  0.000000  0.000000  0.834312  0.414808
3    0.0  2.789933  {\ldots}  0.000000  0.000000  0.000000  0.000000  0.000000
4    0.0  3.851412  {\ldots}  0.000000  0.000000  0.000000  0.000000  0.000000
5    0.0  6.000000  {\ldots}  0.000000  0.000000  0.958634  0.000000  1.276356
6    0.0  0.807682  {\ldots}  0.000000  0.000000  0.000000  0.642143  0.000000
7    0.0  0.050617  {\ldots}  0.000000  1.896831  0.000000  0.000000  0.000000
8    0.0  0.000000  {\ldots}  0.000000  0.354670  0.000000  0.000000  0.000000
9    0.0  1.782197  {\ldots}  0.000000  0.000000  0.000000  0.000000  0.000000

   20475  20476  20477     20478     20479
0    0.0    0.0    0.0  0.000000  0.000000
1    0.0    0.0    0.0  0.000000  0.000000
2    0.0    0.0    0.0  0.000000  0.517837
3    0.0    0.0    0.0  0.000000  0.000000
4    0.0    0.0    0.0  0.438278  0.000000
5    0.0    0.0    0.0  0.000000  0.000000
6    0.0    0.0    0.0  0.000000  0.000000
7    0.0    0.0    0.0  0.000000  0.000000
8    0.0    0.0    0.0  0.000000  0.000000
9    0.0    0.0    0.0  0.000000  0.000000

[10 rows x 20480 columns]
\end{Verbatim}
\end{tcolorbox}
        
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{12}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{df\PYZus{}image\PYZus{}embeddings} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{pred\PYZus{}images}\PY{p}{)}
\PY{n}{df\PYZus{}image\PYZus{}embeddings}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{id}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{p}{[}\PY{n+nb}{id}\PY{o}{.}\PY{n}{replace}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{notebooks/xai\PYZhy{}survey/images/}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{o}{.}\PY{n}{replace}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{.jpg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)} \PY{k}{for} \PY{n+nb}{id} \PY{o+ow}{in} \PY{n}{selected\PYZus{}images}\PY{p}{]}
\PY{c+c1}{\PYZsh{} df\PYZus{}image\PYZus{}embeddings.tail()}
\PY{n}{df\PYZus{}image\PYZus{}embeddings}\PY{o}{.}\PY{n}{info}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
<class 'pandas.core.frame.DataFrame'>
RangeIndex: 44441 entries, 0 to 44440
Columns: 20481 entries, 0 to id
dtypes: float32(20480), object(1)
memory usage: 3.4+ GB
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{13}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} save image embeddings for future reference}
\PY{n}{\PYZus{}save\PYZus{}pickle}\PY{p}{(}\PY{n}{df\PYZus{}image\PYZus{}embeddings}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{df\PYZus{}image\PYZus{}embeddings}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{data}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
/home/mmozolewski/data/df\_image\_embeddings.pickle
    \end{Verbatim}

    \hypertarget{c.-read-metadata-dataset}{%
\section{3c. Read metadata dataset}\label{c.-read-metadata-dataset}}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{9}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} CSV is broken, need to read it manually}
\PY{n}{file1} \PY{o}{=} \PY{n+nb}{open}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{notebooks/xai\PYZhy{}survey/styles.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{r}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{\PYZus{}metadata} \PY{o}{=} \PY{p}{[}\PY{p}{]}
\PY{k}{while} \PY{k+kc}{True}\PY{p}{:}
  \PY{c+c1}{\PYZsh{} Get next line from file}
  \PY{n}{line} \PY{o}{=} \PY{n}{file1}\PY{o}{.}\PY{n}{readline}\PY{p}{(}\PY{p}{)}

  \PY{c+c1}{\PYZsh{} if line is empty}
  \PY{c+c1}{\PYZsh{} end of file is reached}
  \PY{k}{if} \PY{o+ow}{not} \PY{n}{line}\PY{p}{:}
    \PY{k}{break}
  \PY{n}{\PYZus{}metadata}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{line}\PY{o}{.}\PY{n}{strip}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{split}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{,}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{9}\PY{p}{)}\PY{p}{)}
  \PY{c+c1}{\PYZsh{} break}
\PY{n}{file1}\PY{o}{.}\PY{n}{close}\PY{p}{(}\PY{p}{)}

\PY{n}{df\PYZus{}metadata} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{\PYZus{}metadata}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{:}\PY{p}{]}\PY{p}{)}
\PY{n}{df\PYZus{}metadata}\PY{o}{.}\PY{n}{columns} \PY{o}{=} \PY{n}{\PYZus{}metadata}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
\PY{n}{df\PYZus{}metadata}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{9}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
          id gender masterCategory subCategory            articleType  \textbackslash{}
0      15970    Men        Apparel     Topwear                 Shirts
1      39386    Men        Apparel  Bottomwear                  Jeans
2      59263  Women    Accessories     Watches                Watches
3      21379    Men        Apparel  Bottomwear            Track Pants
4      53759    Men        Apparel     Topwear                Tshirts
{\ldots}      {\ldots}    {\ldots}            {\ldots}         {\ldots}                    {\ldots}
44441  17036    Men       Footwear       Shoes           Casual Shoes
44442   6461    Men       Footwear  Flip Flops             Flip Flops
44443  18842    Men        Apparel     Topwear                Tshirts
44444  46694  Women  Personal Care   Fragrance  Perfume and Body Mist
44445  51623  Women    Accessories     Watches                Watches

      baseColour  season  year   usage  \textbackslash{}
0      Navy Blue    Fall  2011  Casual
1           Blue  Summer  2012  Casual
2         Silver  Winter  2016  Casual
3          Black    Fall  2011  Casual
4           Grey  Summer  2012  Casual
{\ldots}          {\ldots}     {\ldots}   {\ldots}     {\ldots}
44441      White  Summer  2013  Casual
44442        Red  Summer  2011  Casual
44443       Blue    Fall  2011  Casual
44444       Blue  Spring  2017  Casual
44445       Pink  Winter  2016  Casual

                                    productDisplayName
0                     Turtle Check Men Navy Blue Shirt
1                   Peter England Men Party Blue Jeans
2                             Titan Women Silver Watch
3        Manchester United Men Solid Black Track Pants
4                                Puma Men Grey T-shirt
{\ldots}                                                {\ldots}
44441                        Gas Men Caddy Casual Shoe
44442               Lotto Men's Soccer Track Flip Flop
44443             Puma Men Graphic Stellar Blue Tshirt
44444                   Rasasi Women Blue Lady Perfume
44445  Fossil Women Pink Dial Chronograph Watch ES3050

[44446 rows x 10 columns]
\end{Verbatim}
\end{tcolorbox}
        
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{20}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} test if we can match emebeddings df and metadata}
\PY{n}{df\PYZus{}metadata\PYZus{}merge\PYZus{}test} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{merge}\PY{p}{(}\PY{n}{df\PYZus{}metadata}\PY{p}{,} \PY{n}{df\PYZus{}image\PYZus{}embeddings}\PY{p}{[}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{id}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{]}\PY{p}{,} \PY{n}{on}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{id}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{c+c1}{\PYZsh{} df\PYZus{}metadata\PYZus{}merge\PYZus{}test.tail()}
\PY{n}{df\PYZus{}metadata\PYZus{}merge\PYZus{}test}\PY{o}{.}\PY{n}{info}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
<class 'pandas.core.frame.DataFrame'>
Int64Index: 44441 entries, 0 to 44440
Data columns (total 12 columns):
 \#   Column              Non-Null Count  Dtype
---  ------              --------------  -----
 0   id                  44441 non-null  object
 1   gender              44441 non-null  object
 2   masterCategory      44441 non-null  object
 3   subCategory         44441 non-null  object
 4   articleType         44441 non-null  object
 5   baseColour          44441 non-null  object
 6   season              44441 non-null  object
 7   year                44441 non-null  object
 8   usage               44441 non-null  object
 9   productDisplayName  44441 non-null  object
 10  0                   44441 non-null  float32
 11  1                   44441 non-null  float32
dtypes: float32(2), object(10)
memory usage: 4.1+ MB
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{21}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} sanity check \PYZhy{} example product}
\PY{n}{\PYZus{}test\PYZus{}N} \PY{o}{=} \PY{l+m+mi}{8889}
\PY{n}{\PYZus{}id} \PY{o}{=} \PY{n}{selected\PYZus{}images}\PY{p}{[}\PY{n}{\PYZus{}test\PYZus{}N}\PY{p}{]}\PY{o}{.}\PY{n}{replace}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{notebooks/xai\PYZhy{}survey/images/}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{o}{.}\PY{n}{replace}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{.jpg}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{images}\PY{p}{[}\PY{n}{\PYZus{}test\PYZus{}N}\PY{p}{]}\PY{p}{)}
\PY{n}{df\PYZus{}metadata\PYZus{}merge\PYZus{}test}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{df\PYZus{}metadata\PYZus{}merge\PYZus{}test}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{id}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{==} \PY{n}{\PYZus{}id}\PY{p}{,} \PY{p}{]}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{21}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
         id gender masterCategory subCategory articleType baseColour  season  \textbackslash{}
5852  43849  Women    Accessories   Jewellery    Earrings      Green  Summer

      year   usage                   productDisplayName    0    1
5852  2012  Ethnic  Royal Diadem White \& Green Earrings  0.0  0.0
\end{Verbatim}
\end{tcolorbox}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_25_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \hypertarget{d.-reduction-of-variables-sapce-with-lsa}{%
\section{3d. Reduction of variables sapce with
LSA}\label{d.-reduction-of-variables-sapce-with-lsa}}

\begin{itemize}
\tightlist
\item
  contribution 1: helper function for LSA (memory optimisation by
  chunking data)
\end{itemize}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{188}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} df\PYZus{}image\PYZus{}embeddings = \PYZus{}read\PYZus{}pandas\PYZus{}pickle(\PYZsq{}df\PYZus{}image\PYZus{}embeddings\PYZsq{}, \PYZsq{}data\PYZsq{})  \PYZsh{} read data back if needed}
\PY{n}{df\PYZus{}image\PYZus{}embeddings\PYZus{}lsa} \PY{o}{=} \PY{n}{get\PYZus{}LSA}\PY{p}{(}\PY{n}{df\PYZus{}image\PYZus{}embeddings}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{id}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{3000}\PY{p}{,} \PY{k+kc}{None}\PY{p}{)}  \PY{c+c1}{\PYZsh{} contribution 1}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
explained variance perc = 93.19395422935486\%
processing chunk 0 of 45
processing chunk 1 of 45
processing chunk 2 of 45
processing chunk 3 of 45
processing chunk 4 of 45
processing chunk 5 of 45
processing chunk 6 of 45
processing chunk 7 of 45
processing chunk 8 of 45
processing chunk 9 of 45
processing chunk 10 of 45
processing chunk 11 of 45
processing chunk 12 of 45
processing chunk 13 of 45
processing chunk 14 of 45
processing chunk 15 of 45
processing chunk 16 of 45
processing chunk 17 of 45
processing chunk 18 of 45
processing chunk 19 of 45
processing chunk 20 of 45
processing chunk 21 of 45
processing chunk 22 of 45
processing chunk 23 of 45
processing chunk 24 of 45
processing chunk 25 of 45
processing chunk 26 of 45
processing chunk 27 of 45
processing chunk 28 of 45
processing chunk 29 of 45
processing chunk 30 of 45
processing chunk 31 of 45
processing chunk 32 of 45
processing chunk 33 of 45
processing chunk 34 of 45
processing chunk 35 of 45
processing chunk 36 of 45
processing chunk 37 of 45
processing chunk 38 of 45
processing chunk 39 of 45
processing chunk 40 of 45
processing chunk 41 of 45
processing chunk 42 of 45
processing chunk 43 of 45
processing chunk 44 of 45
    \end{Verbatim}
# sanity check
count = 0
for i in range(len(df_image_embeddings_lsa_list)):
  count += len(df_image_embeddings_lsa_list[i])
count
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{189}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{df\PYZus{}image\PYZus{}embeddings\PYZus{}lsa}\PY{o}{.}\PY{n}{info}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
<class 'pandas.core.frame.DataFrame'>
RangeIndex: 44441 entries, 0 to 44440
Columns: 3001 entries, 0 to id
dtypes: float32(3000), object(1)
memory usage: 508.9+ MB
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{190}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{df\PYZus{}image\PYZus{}embeddings\PYZus{}lsa}\PY{o}{.}\PY{n}{tail}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{190}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
              0         1         2         3         4         5         6  \textbackslash{}
44436  0.559827  0.364834 -0.179952 -0.091714  0.140205 -0.063002 -0.286837
44437  0.420029  0.027995  0.214225  0.107724 -0.085137  0.196451  0.130375
44438  0.621270 -0.227673  0.001352 -0.146869 -0.194079 -0.013890 -0.056172
44439  0.674413 -0.162095 -0.023080 -0.063712 -0.111598 -0.148997 -0.001704
44440  0.534263  0.429810 -0.251824 -0.156936  0.108749  0.147126 -0.059324

              7         8         9  {\ldots}      2991      2992      2993  \textbackslash{}
44436 -0.152043  0.041409  0.145311  {\ldots} -0.001364 -0.006181 -0.001071
44437 -0.061441 -0.042040  0.191122  {\ldots}  0.003482  0.001846 -0.001265
44438 -0.049083  0.045102  0.031358  {\ldots} -0.001441  0.002704  0.006536
44439 -0.131711  0.026659  0.023306  {\ldots} -0.000907  0.007747 -0.000883
44440  0.058150  0.041745 -0.044854  {\ldots}  0.005234 -0.006177 -0.011308

           2994      2995      2996      2997      2998      2999     id
44436 -0.003781  0.001582  0.003543 -0.010412 -0.004472  0.001637  32518
44437  0.001717  0.004097  0.003086 -0.004396 -0.000383  0.003662  51516
44438 -0.000997 -0.005124  0.001332 -0.002221 -0.003109  0.003998  57442
44439 -0.004208  0.004268  0.000681 -0.003245 -0.006353  0.000244   2065
44440  0.000476  0.005564 -0.006690  0.001247  0.002600 -0.005095  38787

[5 rows x 3001 columns]
\end{Verbatim}
\end{tcolorbox}
        
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{191}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} save LSA for future reference}
\PY{n}{\PYZus{}save\PYZus{}pickle}\PY{p}{(}\PY{n}{df\PYZus{}image\PYZus{}embeddings\PYZus{}lsa}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{n}{df\PYZus{}image\PYZus{}embeddings\PYZus{}lsa}\PY{o}{.}\PY{n}{columns} \PY{o}{!=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{cluster\PYZus{}kmeans}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{df\PYZus{}image\PYZus{}embeddings\PYZus{}lsa}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{data}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
/home/mmozolewski/data/df\_image\_embeddings\_lsa.pickle
    \end{Verbatim}

    \hypertarget{e.-prepare-textual-data-for-explanations}{%
\section{3e. Prepare textual data for
explanations}\label{e.-prepare-textual-data-for-explanations}}

\begin{itemize}
\tightlist
\item
  contribution 2: use numeric variables in textual explanations
\item
  contribution 3: force some terms to be included in explanations
\end{itemize}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{206}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{df\PYZus{}metadata}\PY{o}{.}\PY{n}{describe}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{206}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
           id gender masterCategory subCategory articleType baseColour  \textbackslash{}
count   44446  44446          44446       44446       44446      44446
unique  44446      5              7          45         143         47
top     15970    Men        Apparel     Topwear     Tshirts      Black
freq        1  22165          21400       15405        7070       9732

        season   year   usage            productDisplayName
count    44446  44446   44446                         44446
unique       5     14      10                         31137
top     Summer   2012  Casual  Lucera Women Silver Earrings
freq     21476  16290   34414                            82
\end{Verbatim}
\end{tcolorbox}
        
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{207}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{df\PYZus{}metadata}\PY{o}{.}\PY{n}{info}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
<class 'pandas.core.frame.DataFrame'>
RangeIndex: 44446 entries, 0 to 44445
Data columns (total 10 columns):
 \#   Column              Non-Null Count  Dtype
---  ------              --------------  -----
 0   id                  44446 non-null  object
 1   gender              44446 non-null  object
 2   masterCategory      44446 non-null  object
 3   subCategory         44446 non-null  object
 4   articleType         44446 non-null  object
 5   baseColour          44446 non-null  object
 6   season              44446 non-null  object
 7   year                44446 non-null  object
 8   usage               44446 non-null  object
 9   productDisplayName  44446 non-null  object
dtypes: object(10)
memory usage: 3.4+ MB
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{13}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} stopwords for preprocessing}
\PY{n}{user\PYZus{}defined\PYZus{}stopwords} \PY{o}{=} \PY{n}{spacy\PYZus{}nlp\PYZus{}model}\PY{o}{.}\PY{n}{Defaults}\PY{o}{.}\PY{n}{stop\PYZus{}words}
\PY{n+nb}{print}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{user\PYZus{}defined\PYZus{}stopwords}\PY{p}{)}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{approach}\PY{l+s+s1}{\PYZsq{}} \PY{o+ow}{in} \PY{n}{user\PYZus{}defined\PYZus{}stopwords}\PY{p}{)}

\PY{n}{user\PYZus{}defined\PYZus{}stopwords}\PY{o}{.}\PY{n}{update}\PY{p}{(}\PY{n}{stopwords}\PY{o}{.}\PY{n}{words}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{english}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{user\PYZus{}defined\PYZus{}stopwords}\PY{p}{)}\PY{p}{)}

\PY{n}{df\PYZus{}metadata}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{productDisplayNameCleaned}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{df\PYZus{}metadata}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{productDisplayName}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{apply}\PY{p}{(}\PY{k}{lambda} \PY{n}{x}\PY{p}{:} \PY{n}{finalpreprocess}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{user\PYZus{}defined\PYZus{}stopwords}\PY{p}{)} \PY{k}{if} \PY{n+nb}{isinstance}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n+nb}{str}\PY{p}{)} \PY{o+ow}{and} \PY{n}{x} \PY{o}{!=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZdq{}} \PY{k}{else} \PY{n}{np}\PY{o}{.}\PY{n}{NaN}\PY{p}{)}
\PY{n}{df\PYZus{}metadata}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
326
False
382
    \end{Verbatim}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{13}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
          id gender masterCategory subCategory            articleType  \textbackslash{}
0      15970    Men        Apparel     Topwear                 Shirts
1      39386    Men        Apparel  Bottomwear                  Jeans
2      59263  Women    Accessories     Watches                Watches
3      21379    Men        Apparel  Bottomwear            Track Pants
4      53759    Men        Apparel     Topwear                Tshirts
{\ldots}      {\ldots}    {\ldots}            {\ldots}         {\ldots}                    {\ldots}
44441  17036    Men       Footwear       Shoes           Casual Shoes
44442   6461    Men       Footwear  Flip Flops             Flip Flops
44443  18842    Men        Apparel     Topwear                Tshirts
44444  46694  Women  Personal Care   Fragrance  Perfume and Body Mist
44445  51623  Women    Accessories     Watches                Watches

      baseColour  season  year   usage  \textbackslash{}
0      Navy Blue    Fall  2011  Casual
1           Blue  Summer  2012  Casual
2         Silver  Winter  2016  Casual
3          Black    Fall  2011  Casual
4           Grey  Summer  2012  Casual
{\ldots}          {\ldots}     {\ldots}   {\ldots}     {\ldots}
44441      White  Summer  2013  Casual
44442        Red  Summer  2011  Casual
44443       Blue    Fall  2011  Casual
44444       Blue  Spring  2017  Casual
44445       Pink  Winter  2016  Casual

                                    productDisplayName  \textbackslash{}
0                     Turtle Check Men Navy Blue Shirt
1                   Peter England Men Party Blue Jeans
2                             Titan Women Silver Watch
3        Manchester United Men Solid Black Track Pants
4                                Puma Men Grey T-shirt
{\ldots}                                                {\ldots}
44441                        Gas Men Caddy Casual Shoe
44442               Lotto Men's Soccer Track Flip Flop
44443             Puma Men Graphic Stellar Blue Tshirt
44444                   Rasasi Women Blue Lady Perfume
44445  Fossil Women Pink Dial Chronograph Watch ES3050

                          productDisplayNameCleaned
0                  turtle check men navy blue shirt
1                 peter england men party blue jean
2                          titan woman silver watch
3      manchester united men solid black track pant
4                               puma men grey shirt
{\ldots}                                             {\ldots}
44441                     gas men caddy casual shoe
44442              lotto men soccer track flip flop
44443          puma men graphic stellar blue tshirt
44444                rasasi woman blue lady perfume
44445    fossil woman pink dial chronograph watch e

[44446 rows x 11 columns]
\end{Verbatim}
\end{tcolorbox}
        
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{14}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} use metadata in textual explanations:}
\PY{n}{df\PYZus{}metadata}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{yearLabel}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Year}\PY{l+s+s1}{\PYZsq{}} \PY{o}{+} \PY{n}{df\PYZus{}metadata}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{year}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}  \PY{c+c1}{\PYZsh{} contribution 2}

\PY{n}{df\PYZus{}metadata}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{explainColumn}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{df\PYZus{}metadata}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{gender}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ }\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PYZbs{}
                               \PY{n}{df\PYZus{}metadata}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{masterCategory}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ }\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PYZbs{}
                               \PY{n}{df\PYZus{}metadata}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{subCategory}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ }\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PYZbs{}
                               \PY{n}{df\PYZus{}metadata}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{articleType}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ }\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PYZbs{}
                               \PY{n}{df\PYZus{}metadata}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{baseColour}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ }\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PYZbs{}
                               \PY{n}{df\PYZus{}metadata}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{season}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ }\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PYZbs{}
                               \PY{n}{df\PYZus{}metadata}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{yearLabel}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ }\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PYZbs{}
                               \PY{n}{df\PYZus{}metadata}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{usage}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ }\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PYZbs{}
                               \PY{n}{df\PYZus{}metadata}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{productDisplayNameCleaned}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{c+c1}{\PYZsh{} + \PYZdq{} \PYZdq{} + \PYZbs{}}

\PY{n}{df\PYZus{}metadata}\PY{p}{[}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{explainColumn}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{14}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
                                           explainColumn
0      Men Apparel Topwear Shirts Navy Blue Fall Year{\ldots}
1      Men Apparel Bottomwear Jeans Blue Summer Year2{\ldots}
2      Women Accessories Watches Watches Silver Winte{\ldots}
3      Men Apparel Bottomwear Track Pants Black Fall {\ldots}
4      Men Apparel Topwear Tshirts Grey Summer Year20{\ldots}
{\ldots}                                                  {\ldots}
44441  Men Footwear Shoes Casual Shoes White Summer Y{\ldots}
44442  Men Footwear Flip Flops Flip Flops Red Summer {\ldots}
44443  Men Apparel Topwear Tshirts Blue Fall Year2011{\ldots}
44444  Women Personal Care Fragrance Perfume and Body{\ldots}
44445  Women Accessories Watches Watches Pink Winter {\ldots}

[44446 rows x 1 columns]
\end{Verbatim}
\end{tcolorbox}
        
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{15}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} contribution 3 \PYZhy{} force some terms to be included in explanations:}
\PY{n}{words\PYZus{}to\PYZus{}include\PYZus{}starting\PYZus{}list} \PY{o}{=} \PY{n}{make\PYZus{}include\PYZus{}list}\PY{p}{(}\PY{n}{df\PYZus{}metadata}\PY{p}{,} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{gender}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{masterCategory}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{subCategory}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                                                                 \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{articleType}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{baseColour}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{season}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                                                                \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{yearLabel}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{usage}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{p}{]}\PY{p}{)}
\PY{n}{words\PYZus{}to\PYZus{}include\PYZus{}starting\PYZus{}list} \PY{o}{=} \PY{p}{[}\PY{n}{x}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{replace}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)} \PY{k}{for} \PY{n}{x} \PY{o+ow}{in} \PY{n}{words\PYZus{}to\PYZus{}include\PYZus{}starting\PYZus{}list} \PY{k}{if} \PY{n}{x} \PY{o+ow}{and} \PY{n}{x} \PY{o}{!=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{NA}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
\PY{n+nb}{print}\PY{p}{(}\PY{n}{words\PYZus{}to\PYZus{}include\PYZus{}starting\PYZus{}list}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
['CasualShoes', 'Jewellery', 'AccessoryGiftSet', 'Multi', 'TurquoiseBlue',
'Red', 'Shirts', 'Boxers', 'Cream', 'Patiala', 'Cufflinks', 'Salwar',
'LipPlumper', 'HighlighterAndBlush', 'Trunk', 'LipCare', 'Footballs', 'Fall',
'LipGloss', 'ShoeLaces', 'Makeup', 'Churidar', 'EyeCream', 'Briefs', 'Year2008',
'Robe', 'Hat', 'SportingGoods', 'Innerwear', 'Backpacks', 'Caps',
'BodyWashAndScrub', 'Year2013', 'NavyBlue', 'SportsEquipment', 'Travel',
'RainTrousers', 'Heels', 'Watches', 'Tops', 'KurtaSets', 'LoungeShorts',
'Scarves', 'Year2007', 'GreyMelange', 'Sarees', 'Ethnic', 'TrackPants',
'Gloves', 'Kurtis', 'RainJacket', 'Rompers', 'BathAndBody', 'Camisoles',
'Toner', 'Winter', 'Sports', 'Handbags', 'Bottomwear', 'Peach', 'Perfumes',
'Dress', 'Jeggings', 'SportsAccessories', 'Shorts', 'Sandal', 'Trousers',
'White', 'KajalAndEyeliner', 'Kurtas', 'Casual', 'LehengaCholi', 'LaptopBag',
'Fragrance', 'Year2010', 'Tan', 'BathRobe', 'Silver', 'Black', 'CoffeeBrown',
'Taupe', 'Year2015', 'SportsSandals', 'Spring', 'NailPolish', 'Tunics',
'TiesAndCufflinks', 'FaceWashAndCleanser', 'Socks', 'MaskAndPeel', 'OffWhite',
'Summer', 'Year2009', 'Brown', 'Capris', 'HomeFurnishing', 'Bangle', 'Unisex',
'Suspenders', 'MensGroomingKit', 'Burgundy', 'Jumpsuit', 'TabletSleeve',
'Year2017', 'Tracksuits', 'Orange', 'Blue', 'Tights', 'Dresses', 'Purple',
'Year2016', 'Saree', 'Rose', 'Umbrellas', 'Deodorant', 'Apparel', 'Ring',
'SalwarAndDupatta', 'BodyLotion', 'Sweatshirts', 'Eyes', 'Mauve',
'CushionCovers', 'Mascara', 'ApparelSet', 'FormalShoes', 'FragranceGiftSet',
'Accessories', 'Stoles', 'Nightdress', 'Rucksacks', 'Maroon', 'Metallic',
'LimeGreen', 'Headwear', 'Stockings', 'MushroomBrown', 'Year2018',
'WaterBottle', 'Sweaters', 'MakeupRemover', 'LoungePants', 'NecklaceAndChains',
'Wristbands', 'TrolleyBag', 'MessengerBag', 'LoungeTshirts', 'FaceMoisturisers',
'NehruJackets', 'Headband', 'Year2014', 'Sandals', 'Khaki', 'Ties', 'Formal',
'HairAccessory', 'Mustard', 'Pendant', 'Women', 'DuffelBag', 'Sunscreen',
'SkinCare', 'Topwear', 'FoundationAndPrimer', 'Ipad', 'Year', 'WaistPouch',
'Olive', 'SmartCasual', 'Bags', 'Gold', 'Jackets', 'Basketballs', 'MobilePouch',
'Yellow', 'FluorescentGreen', 'ShoeAccessories', 'Waistcoat', 'Jeans',
'LoungewearAndNightwear', 'HairColour', 'Charcoal', 'Girls', 'NightSuits',
'Teal', 'Skin', 'Swimwear', 'Vouchers', 'Pink', 'Lipstick', 'FreeItems',
'BabyDolls', 'Leggings', 'Concealer', 'Dupatta', 'Beige', 'LipLiner', 'Magenta',
'Footwear', 'Flats', 'Sunglasses', 'Belts', 'BeautyAccessory',
'FaceScrubAndExfoliator', 'Year2019', 'FlipFlops', 'PersonalCare',
'InnerwearVests', 'Home', 'Bracelet', 'FreeGifts', 'SeaGreen', 'Grey', 'Men',
'Compact', 'Earrings', 'Booties', 'Year2012', 'Party', 'Shapewear', 'Rust',
'Mufflers', 'Copper', 'Blazers', 'Bra', 'Nude', 'ClothingSet', 'SportsShoes',
'PerfumeAndBodyMist', 'Bronze', 'Green', 'Lips', 'Nails', 'Suits', 'Eyeshadow',
'Lavender', 'Year2011', 'Skirts', 'Shrug', 'Clutches', 'Tshirts', 'Steel',
'JewellerySet', 'Shoes', 'Boys', 'KeyChain', 'NailEssentials',
'FaceSerumAndGel', 'BeautyAccessories', 'Hair', 'TravelAccessory', 'Wallets',
'Eyewear']
    \end{Verbatim}

    \hypertarget{example-on-subsample}{%
\section{4 Example on subsample}\label{example-on-subsample}}

\begin{itemize}
\tightlist
\item
  contribution 4: help to find correct number of clusters with visual
  aid
\end{itemize}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{12}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{df\PYZus{}image\PYZus{}embeddings\PYZus{}lsa} \PY{o}{=} \PY{n}{\PYZus{}read\PYZus{}pandas\PYZus{}pickle}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{df\PYZus{}image\PYZus{}embeddings\PYZus{}lsa}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{/home/mmozolewski/data}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}  \PY{c+c1}{\PYZsh{} read data back if needed}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{108}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} draw subsample}
\PY{n}{df\PYZus{}image\PYZus{}embeddings\PYZus{}lsa\PYZus{}5k\PYZus{}subsample} \PY{o}{=} \PY{n}{df\PYZus{}image\PYZus{}embeddings\PYZus{}lsa}\PY{o}{.}\PY{n}{sample}\PY{p}{(}\PY{n}{n} \PY{o}{=} \PY{l+m+mi}{5000}\PY{p}{)}\PY{o}{.}\PY{n}{copy}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{145}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{\PYZus{}pipeline} \PY{o}{=} \PY{n}{Pipeline}\PY{p}{(}\PY{n}{df\PYZus{}image\PYZus{}embeddings\PYZus{}lsa\PYZus{}5k\PYZus{}subsample}\PY{p}{,} \PY{n}{key} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{id}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}  \PY{c+c1}{\PYZsh{} contribution 4: plots TSNE on 30\PYZpc{} of observations as a hint for number of clusters}
\PY{n}{\PYZus{}pipeline}\PY{o}{.}\PY{n}{df}\PY{o}{.}\PY{n}{info}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
using 1500 observations
<class 'pandas.core.frame.DataFrame'>
RangeIndex: 5000 entries, 0 to 4999
Columns: 3002 entries, 0 to cluster\_kmeans
dtypes: float32(3000), float64(1), object(1)
memory usage: 57.3+ MB
    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_41_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \hypertarget{b.-plotting-silhouette}{%
\section{4b. Plotting Silhouette}\label{b.-plotting-silhouette}}

\begin{itemize}
\item ~
  \hypertarget{contribution-4-find-optimal-number-of-clusters-in-k-means}{%
  \section{contribution 4: find optimal number of clusters in
  k-means}\label{contribution-4-find-optimal-number-of-clusters-in-k-means}}
\end{itemize}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{150}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{\PYZus{}pipeline}\PY{o}{.}\PY{n}{plot\PYZus{}silhouette}\PY{p}{(}\PY{l+m+mi}{30}\PY{p}{,} \PY{k+kc}{None}\PY{p}{,} \PY{k+kc}{True}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
processing 2 clusters
processing 3 clusters
processing 4 clusters
processing 5 clusters
processing 6 clusters
processing 7 clusters
processing 8 clusters
processing 9 clusters
processing 10 clusters
processing 11 clusters
processing 12 clusters
processing 13 clusters
processing 14 clusters
processing 15 clusters
processing 16 clusters
processing 17 clusters
processing 18 clusters
processing 19 clusters
processing 20 clusters
processing 21 clusters
processing 22 clusters
processing 23 clusters
processing 24 clusters
processing 25 clusters
processing 26 clusters
processing 27 clusters
processing 28 clusters
processing 29 clusters
processing 30 clusters
    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_43_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \hypertarget{c.-fit-and-plot}{%
\section{4c. Fit and plot}\label{c.-fit-and-plot}}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{151}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{}\PYZsh{} given silhouette and tsne on this sample:}
\PY{n}{\PYZus{}pipeline}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{l+m+mi}{8}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_45_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \hypertarget{d.-use-textual-data}{%
\section{4d. Use Textual data}\label{d.-use-textual-data}}

\begin{itemize}
\tightlist
\item
  contribution 5: visualise clusters with textual labels
\end{itemize}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{152}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{\PYZus{}pipeline}\PY{o}{.}\PY{n}{init\PYZus{}metadata}\PY{p}{(}\PY{n}{df\PYZus{}metadata}\PY{p}{)}
\PY{n}{\PYZus{}pipeline}\PY{o}{.}\PY{n}{df\PYZus{}metadata}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
clusters= ['0', '1', '2', '3', '4', '5', '6', '7']
    \end{Verbatim}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{152}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
         id        x1        x2  cluster\_kmeans gender masterCategory  \textbackslash{}
0     30493  0.429710  0.977552               1  Women        Apparel
1     23279  0.197574  0.155921               6    Men    Accessories
2      9080  0.670564  0.709275               4    Men        Apparel
3     19650  0.352656  0.892560               1  Women        Apparel
4     13640  0.821013  0.321833               2  Women       Footwear
{\ldots}     {\ldots}       {\ldots}       {\ldots}             {\ldots}    {\ldots}            {\ldots}
4995   3391  0.486293  0.109075               0  Women    Accessories
4996  48148  0.475537  0.286937               0  Women    Accessories
4997  49640  0.387261  0.869516               1  Women        Apparel
4998  19892  0.794497  0.538489               7    Men    Accessories
4999  37969  0.672493  0.312087               2  Women       Footwear

     subCategory  articleType      baseColour  season  year   usage  \textbackslash{}
0      Innerwear          Bra            Pink  Summer  2014  Casual
1        Watches      Watches            Blue  Winter  2016  Casual
2     Bottomwear  Track Pants            Grey    Fall  2011  Sports
3        Topwear         Tops          Purple    Fall  2011  Casual
4          Shoes        Flats          Purple  Winter  2012  Casual
{\ldots}          {\ldots}          {\ldots}             {\ldots}     {\ldots}   {\ldots}     {\ldots}
4995        Bags     Handbags           White  Winter  2015  Casual
4996     Wallets      Wallets             Red  Winter  2016  Casual
4997     Topwear         Tops  Turquoise Blue  Summer  2012  Casual
4998       Belts        Belts           Black    Fall  2011  Casual
4999       Shoes        Heels           Taupe    Fall  2012  Casual

                                    productDisplayName  \textbackslash{}
0                    Lovable Women Fiona Rose Pink Bra
1                        Maxima Ssteele Men Blue Watch
2                 ADIDAS Men Adna Revpt Grey Trackpant
3     United Colors of Benetton Women Solid Purple Top
4               Carlton London Women Purple Flat Shoes
{\ldots}                                                {\ldots}
4995                Murcia Women White With Stitch Bag
4996                           Fossil Women Red Wallet
4997                  Mineral Women Turquoise Blue Top
4998                         Lee Men Canvas Black Belt
4999                          Clarks Women Taupe Heels

                     productDisplayNameCleaned yearLabel  \textbackslash{}
0            lovable woman fiona rise pink bra  Year2014
1               maximum ssteele men blue watch  Year2016
2         adidas men adna revpt grey trackpant  Year2011
3     united color benetton woman solid purple  Year2011
4        carlton london woman purple flat shoe  Year2012
{\ldots}                                        {\ldots}       {\ldots}
4995             murcia woman white stitch bag  Year2015
4996                   fossil woman red wallet  Year2016
4997              mineral woman turquoise blue  Year2012
4998                 lee men canvas black belt  Year2011
4999                    clark woman taupe heel  Year2012

                                          explainColumn
0     Women Apparel Innerwear Bra Pink Summer Year20{\ldots}
1     Men Accessories Watches Watches Blue Winter Ye{\ldots}
2     Men Apparel Bottomwear Track Pants Grey Fall Y{\ldots}
3     Women Apparel Topwear Tops Purple Fall Year201{\ldots}
4     Women Footwear Shoes Flats Purple Winter Year2{\ldots}
{\ldots}                                                 {\ldots}
4995  Women Accessories Bags Handbags White Winter Y{\ldots}
4996  Women Accessories Wallets Wallets Red Winter Y{\ldots}
4997  Women Apparel Topwear Tops Turquoise Blue Summ{\ldots}
4998  Men Accessories Belts Belts Black Fall Year201{\ldots}
4999  Women Footwear Shoes Heels Taupe Fall Year2012{\ldots}

[5000 rows x 16 columns]
\end{Verbatim}
\end{tcolorbox}
        
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{153}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{\PYZus{}pipeline}\PY{o}{.}\PY{n}{visualise\PYZus{}clustering}\PY{p}{(}\PY{n}{column\PYZus{}year} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{year}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{column\PYZus{}txt} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{productDisplayName}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{random\PYZus{}subsample}\PY{o}{=}\PY{l+m+mf}{.1}\PY{p}{,} \PY{n}{size}\PY{o}{=}\PY{l+m+mi}{4}\PY{p}{)}  \PY{c+c1}{\PYZsh{} contribution 5: plot on subsample, size factor}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_48_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \hypertarget{e.-explanations-based-on-textual-data}{%
\section{4e. Explanations based on textual
data}\label{e.-explanations-based-on-textual-data}}

\begin{itemize}
\tightlist
\item
  contribution 6:

  \begin{itemize}
  \tightlist
  \item
    interactively set amount of vocabulary: observe what terms are
    important (TfidfVectorizer)
  \item
    train DecisionTreeClassifier on using both user defined blacklist
    (stopwords) and withe list (words to include, like year)
  \item
    check Test accuracy and, weighted avg f1-score and confusion matrix
  \item
    observe how classifier explains discovered categories
  \end{itemize}
\end{itemize}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{155}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{\PYZus{}pipeline}\PY{o}{.}\PY{n}{explain}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{explainColumn}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{120}\PY{p}{,} \PY{n}{user\PYZus{}defined\PYZus{}stopwords}\PY{p}{,} \PY{n}{words\PYZus{}to\PYZus{}include\PYZus{}starting\PYZus{}list}\PY{p}{)}  \PY{c+c1}{\PYZsh{} set to get good enough accuracy}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Explanations will use: ['heels', 'sandal', 'shoes heels', 'winter year2012',
'woman black', 'footwear shoes heels', 'women footwear shoes heels', 'check',
'tops', 'puma', 'topwear tops', 'casual puma', 'apparel topwear tops', 'women
apparel topwear tops', 'black summer year2012 casual', 'silver', 'black fall',
'fall year2012', 'year2012 sports', 'pink', 'fall year2012 casual', 'kurtas',
'kurta', 'topwear kurtas', 'woman print', 'apparel topwear kurtas', 'women
apparel topwear kurtas', 'puma men', 'men accessories watches', 'men accessories
watches watches', 'purple', 'flip', 'flops', 'flip flops', 'adidas', 'casual
adidas', 'adidas men', 'men apparel bottomwear', 'black winter year2016', 'black
winter year2016 casual', 'white fall', 'women apparel topwear tshirts',
'handbags', 'bags handbags', 'women accessories bags', 'accessories bags
handbags', 'women accessories bags handbags', 'sport', 'shoes sports', 'sports
shoes', 'shoes white', 'men white', 'sport shoe', 'footwear shoes sports',
'shoes sports shoes', 'men footwear shoes sports', 'footwear shoes sports
shoes', 'men footwear shoes sports shoes', 'shoes black', 'dial', 'dial watch',
'eyewear', 'sunglasses', 'maroon', 'solid', 'united', 'color', 'benetton',
'handbag', 'casual united', 'united color', 'color benetton', 'casual united
color', 'united color benetton', 'casual united color benetton', 'men footwear
shoes casual', 'men footwear shoes casual shoes', 'blue fall', 'blue fall
year2011', 'blue fall year2011 casual', 'unisex', 'unisex accessories',
'year2011 formal', 'black fall year2011', 'year2013', 'innerwear', 'apparel
innerwear', 'red summer', 'summer year2016', 'summer year2016 casual', 'brown
winter', 'polo', 'tshirts blue', 'blue shirt', 'topwear tshirts blue', 'blue
summer year2012', 'apparel topwear tshirts blue', 'blue summer year2012 casual',
'year2012 ethnic', 'boys', 'women personal', 'women personal care', 'navy',
'navy blue', 'year2011 sports', 'brown summer', 'strip', 'orange', 'white summer
year2012', 'yellow', 'nike men', 'summer year2012 ethnic', 'wallets', 'belts',
'green summer', 'grey summer', 'fragrance', 'perfume', 'socks', 'sports nike']
Train accuracy 0.6025
Test accuracy 0.575
              precision    recall  f1-score   support

           0       0.74      0.40      0.52       205
           1       0.68      0.53      0.59       177
           2       0.46      0.85      0.59       203
           3       0.75      0.94      0.83        48
           4       0.35      0.23      0.28        74
           5       0.47      0.48      0.48       152
           6       0.76      0.57      0.65        94
           7       1.00      0.77      0.87        47

    accuracy                           0.57      1000
   macro avg       0.65      0.60      0.60      1000
weighted avg       0.62      0.57      0.57      1000

Confusion Matrix:
[[ 83  22  53   5  18   8  16   0]
 [  5  94  42   2   8  26   0   0]
 [  4   3 173   3   0  19   1   0]
 [  1   0   2  45   0   0   0   0]
 [  4   4  29   0  17  20   0   0]
 [  6   9  58   1   5  73   0   0]
 [  5   7  18   2   0   8  54   0]
 [  4   0   5   2   0   0   0  36]]
    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_50_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \hypertarget{f.-use-lime-to-get-example-explanation-from-classifier}{%
\section{4f. Use Lime to get example explanation from
classifier}\label{f.-use-lime-to-get-example-explanation-from-classifier}}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{156}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{\PYZus{}pipeline}\PY{o}{.}\PY{n}{lime\PYZus{}example}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{0}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}  \PY{c+c1}{\PYZsh{} for class \PYZdq{}0\PYZdq{}}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Cluster= 0, text= Women Accessories Bags Clutches Green Summer Year2012 Casual
mod acc woman green clutch
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
<IPython.core.display.HTML object>
    \end{Verbatim}

    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{158}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{\PYZus{}pipeline}\PY{o}{.}\PY{n}{lime\PYZus{}example}\PY{p}{(}\PY{k+kc}{None}\PY{p}{)}  \PY{c+c1}{\PYZsh{} for random class}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Cluster= 2, text= Men Footwear Shoes Casual Shoes Black Fall Year2011 Casual
enroute men leather black casual shoe
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
<IPython.core.display.HTML object>
    \end{Verbatim}

    
    \hypertarget{g.-plot-word-clouds}{%
\section{4g. Plot word clouds}\label{g.-plot-word-clouds}}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{159}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{\PYZus{}pipeline}\PY{o}{.}\PY{n}{word\PYZus{}cloud}\PY{p}{(}\PY{n}{plot\PYZus{}example}\PY{p}{,} \PY{k+kc}{False}\PY{p}{)}  \PY{c+c1}{\PYZsh{} pass function which presents examples of observations}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
cluster= 0
    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_55_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_55_2.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
cluster= 1
    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_55_4.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_55_5.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
cluster= 2
    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_55_7.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_55_8.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
cluster= 3
    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_55_10.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_55_11.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
cluster= 4
    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_55_13.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_55_14.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
cluster= 5
    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_55_16.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_55_17.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
cluster= 6
    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_55_19.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_55_20.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
cluster= 7
    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_55_22.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_55_23.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \hypertarget{full-scale-example-some-plots-omited}{%
\section{Full scale example (some plots
omited)}\label{full-scale-example-some-plots-omited}}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{161}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{\PYZus{}pipeline\PYZus{}full} \PY{o}{=} \PY{n}{Pipeline}\PY{p}{(}\PY{n}{df\PYZus{}image\PYZus{}embeddings\PYZus{}lsa}\PY{p}{,} \PY{n}{key} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{id}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
using 13332 observations
    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_57_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{213}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{\PYZus{}pipeline\PYZus{}full}\PY{o}{.}\PY{n}{plot\PYZus{}silhouette}\PY{p}{(}\PY{l+m+mi}{150}\PY{p}{,} \PY{k+kc}{None}\PY{p}{,} \PY{k+kc}{False}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_58_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{163}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{\PYZus{}pipeline\PYZus{}full}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{l+m+mi}{18}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_59_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{164}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{\PYZus{}pipeline\PYZus{}full}\PY{o}{.}\PY{n}{init\PYZus{}metadata}\PY{p}{(}\PY{n}{df\PYZus{}metadata}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
clusters= ['0', '1', '10', '11', '12', '13', '14', '15', '16', '17', '2', '3',
'4', '5', '6', '7', '8', '9']
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{165}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{\PYZus{}pipeline\PYZus{}full}\PY{o}{.}\PY{n}{explain}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{explainColumn}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{120}\PY{p}{,} \PY{n}{user\PYZus{}defined\PYZus{}stopwords}\PY{p}{,} \PY{n}{words\PYZus{}to\PYZus{}include\PYZus{}starting\PYZus{}list}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Explanations will use: ['unisex', 'pink', 'purple', 'women accessories bags',
'handbags', 'handbag', 'bags handbags', 'accessories bags handbags', 'women
accessories bags handbags', 'red summer', 'year2011 sports', 'sports nike',
'nike men', 'heels', 'shoes heels', 'footwear shoes heels', 'women footwear
shoes heels', 'tops', 'topwear tops', 'apparel topwear tops', 'women apparel
topwear tops', 'puma', 'sport', 'shoes sports', 'sports shoes', 'shoes white',
'year2012 sports', 'puma men', 'sport shoe', 'footwear shoes sports', 'shoes
sports shoes', 'white summer year2012', 'men footwear shoes sports', 'footwear
shoes sports shoes', 'men footwear shoes sports shoes', 'white fall', 'men
white', 'white fall year2011', 'fall year2011 sports', 'tshirts white', 'woman
print', 'topwear tshirts white', 'women apparel topwear tshirts', 'apparel
topwear tshirts white', 'green summer', 'belts', 'brown summer', 'casual puma',
'kurtas', 'navy', 'solid', 'kurta', 'topwear kurtas', 'navy blue', 'blue fall',
'apparel topwear kurtas', 'blue fall year2011', 'women apparel topwear kurtas',
'united', 'color', 'benetton', 'casual united', 'united color', 'color
benetton', 'casual united color', 'united color benetton', 'blue fall year2011
casual', 'casual united color benetton', 'eyewear', 'innerwear', 'apparel
innerwear', 'summer year2016', 'summer year2016 casual', 'strip', 'fall
year2012', 'adidas', 'shoes black', 'adidas men', 'men apparel bottomwear',
'black winter year2016', 'black winter year2016 casual', 'summer year2012
ethnic', 'casual adidas', 'blue summer year2012 casual', 'brown winter', 'casual
shoe', 'wallets', 'fragrance', 'perfume', 'spring year2017 casual', 'check',
'blue shirt', 'flip', 'flops', 'flip flops', 'sandal', 'grey summer', 'black
summer year2012 casual', 'men accessories watches', 'men accessories watches
watches', 'year2013', 'socks', 'jewellery', 'silver', 'unisex accessories',
'winter year2012', 'woman black', 'winter year2012 casual', 'yellow', 'polo',
'fall year2012 casual', 'beige', 'black fall year2011', 'black fall year2011
casual', 'women personal', 'women personal care', 'boys', 'dial', 'dial watch',
'maroon']
Train accuracy 0.5288591359135913
Test accuracy 0.5222184722690967
              precision    recall  f1-score   support

           0       0.59      0.35      0.44       759
           1       0.56      0.41      0.47       441
           2       0.27      0.83      0.41      1219
           3       0.72      0.34      0.46       648
           4       0.82      0.83      0.82       683
           5       0.95      0.79      0.86       193
           6       0.67      0.44      0.53      1061
           7       0.78      0.70      0.74       412
           8       0.61      0.25      0.36       354
           9       0.28      0.06      0.09       418
          10       0.81      0.47      0.59       689
          11       0.00      0.00      0.00        66
          12       0.32      0.06      0.10       487
          13       0.69      0.91      0.79       455
          14       0.96      0.63      0.76       257
          15       1.00      0.98      0.99       234
          16       0.54      0.47      0.50       440
          17       0.67      0.16      0.26        73

    accuracy                           0.52      8889
   macro avg       0.62      0.48      0.51      8889
weighted avg       0.61      0.52      0.51      8889

Confusion Matrix:
[[ 267    9  317    0    0    1   80    0    0    4   50    0    4    1
     0    0   26    0]
 [  16  181  214    2    0    0    5    1    0    2   11    0    0    2
     0    0    7    0]
 [  26   89 1014   10    1    0   23    0    0   14   15    0   13    0
     0    0   14    0]
 [   2    4  303  220   57    0    3    5    3    2    0    0   20   23
     0    0    6    0]
 [   0    0   74   20  564    0    2    1    0    3    0    0    8    9
     0    0    2    0]
 [   0    0    8    0    0  152   17    3    0    0    0    0    0    8
     0    0    5    0]
 [  60   14  273    7    4    4  463   29   53    4    0    0    1   95
     5    0   45    4]
 [   0    0  102    3    0    0    0  290    1    0    0    0    0   12
     0    0    4    0]
 [  38    3  185    0    0    0    7    0   89    1    0    0    1   15
     0    0   15    0]
 [   1   12  352    2    0    0    8    0    0   23    0    0   14    0
     0    0    6    0]
 [  42    7  266    0    1    2    0    1    0   11  324    0    1    2
     0    0   32    0]
 [   0    5   55    0    0    0    0    0    0    1    0    0    0    0
     0    0    5    0]
 [   0    1  343   36   61    0    0    2    0    8    0    0   29    6
     0    0    1    0]
 [   1    0   21    2    0    0   10    0    0    1    2    0    0  416
     2    0    0    0]
 [   0    0   49    1    0    1   13    3    0    3    0    0    0   11
   163    0   11    2]
 [   0    0    4    0    0    0    0    0    0    0    0    0    0    1
     0  229    0    0]
 [   0    0  181    1    1    0    5   38    1    5    0    0    0    2
     0    0  206    0]
 [   2    0    1    0    0    0   58    0    0    0    0    0    0    0
     0    0    0   12]]
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
/home/mmozolewski/.local/lib/python3.8/site-
packages/sklearn/metrics/\_classification.py:1248: UndefinedMetricWarning:
Precision and F-score are ill-defined and being set to 0.0 in labels with no
predicted samples. Use `zero\_division` parameter to control this behavior.
  \_warn\_prf(average, modifier, msg\_start, len(result))
/home/mmozolewski/.local/lib/python3.8/site-
packages/sklearn/metrics/\_classification.py:1248: UndefinedMetricWarning:
Precision and F-score are ill-defined and being set to 0.0 in labels with no
predicted samples. Use `zero\_division` parameter to control this behavior.
  \_warn\_prf(average, modifier, msg\_start, len(result))
/home/mmozolewski/.local/lib/python3.8/site-
packages/sklearn/metrics/\_classification.py:1248: UndefinedMetricWarning:
Precision and F-score are ill-defined and being set to 0.0 in labels with no
predicted samples. Use `zero\_division` parameter to control this behavior.
  \_warn\_prf(average, modifier, msg\_start, len(result))
    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_61_2.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{170}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{\PYZus{}pipeline\PYZus{}full}\PY{o}{.}\PY{n}{word\PYZus{}cloud}\PY{p}{(}\PY{n}{plot\PYZus{}example}\PY{p}{,} \PY{n}{present\PYZus{}lime}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
cluster= 0
Cluster= 0, text= Women Apparel Topwear Tshirts Off White Fall Year2011 Casual
little miss woman print white shirt
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
<IPython.core.display.HTML object>
    \end{Verbatim}

    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_62_2.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_62_3.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
cluster= 1
Cluster= 1, text= Men Apparel Topwear Shirts Blue Winter Year2015 Casual probase
blue black check slim fit casual shirt
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
<IPython.core.display.HTML object>
    \end{Verbatim}

    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_62_6.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_62_7.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
cluster= 10
Cluster= 10, text= Women Apparel Loungewear and Nightwear Night suits Pink
Summer Year2012 Casual little miss intimate pink black pyjama set
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
<IPython.core.display.HTML object>
    \end{Verbatim}

    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_62_10.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_62_11.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
cluster= 11
Cluster= 11, text= Women Personal Care Makeup Kajal and Eyeliner Olive Spring
Year2017 Casual deborah kajal
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
<IPython.core.display.HTML object>
    \end{Verbatim}

    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_62_14.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_62_15.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
cluster= 12
Cluster= 12, text= Unisex Footwear Sandal Sandals Black Summer Year2011 Casual
crocs crocband kid black sandal
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
<IPython.core.display.HTML object>
    \end{Verbatim}

    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_62_18.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_62_19.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
cluster= 13
Cluster= 13, text= Women Accessories Bags Handbags Olive Fall Year2012 Casual
baggit woman olive handbag
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
<IPython.core.display.HTML object>
    \end{Verbatim}

    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_62_22.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_62_23.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
cluster= 14
Cluster= 14, text= Unisex Accessories Bags Handbags Black Winter Year2012 Casual
tortoise unisex black sling bag
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
<IPython.core.display.HTML object>
    \end{Verbatim}

    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_62_26.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_62_27.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
cluster= 15
Cluster= 15, text= Unisex Accessories Eyewear Sunglasses Silver Winter Year2016
Casual polaroid unisex sunglass
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
<IPython.core.display.HTML object>
    \end{Verbatim}

    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_62_30.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_62_31.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
cluster= 16
Cluster= 16, text= Women Personal Care Fragrance Deodorant Pink Spring Year2017
Casual playboy woman play sexy deo
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
<IPython.core.display.HTML object>
    \end{Verbatim}

    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_62_34.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_62_35.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
cluster= 17
Cluster= 17, text= Men Apparel Innerwear Briefs Navy Blue Summer Year2016 Casual
park avenue men navy blue brief
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
<IPython.core.display.HTML object>
    \end{Verbatim}

    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_62_38.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_62_39.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
cluster= 2
Cluster= 2, text= Men Apparel Innerwear Innerwear Vests White Summer Year2016
Casual levis men white innerwear vest
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
<IPython.core.display.HTML object>
    \end{Verbatim}

    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_62_42.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_62_43.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
cluster= 3
Cluster= 3, text= Men Footwear Shoes Sports Shoes Black Fall Year2011 Sports
reebok men run sheer black sport shoe
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
<IPython.core.display.HTML object>
    \end{Verbatim}

    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_62_46.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_62_47.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
cluster= 4
Cluster= 4, text= Men Footwear Sandal Sandals Brown Summer Year2011 Casual
ganuchi men casual brown sandal
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
<IPython.core.display.HTML object>
    \end{Verbatim}

    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_62_50.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_62_51.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
cluster= 5
Cluster= 5, text= Women Accessories Jewellery Bracelet Silver Summer Year2013
Casual lucera woman silver bracelet
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
<IPython.core.display.HTML object>
    \end{Verbatim}

    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_62_54.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_62_55.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
cluster= 6
Cluster= 6, text= Women Personal Care Makeup Compact Skin Spring Year2017 Casual
streetwear shine divine whiten ivory compact
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
<IPython.core.display.HTML object>
    \end{Verbatim}

    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_62_58.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_62_59.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
cluster= 7
Cluster= 7, text= Men Accessories Watches Watches Black Winter Year2016 Casual
fastrack men black dial watch
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
<IPython.core.display.HTML object>
    \end{Verbatim}

    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_62_62.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_62_63.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
cluster= 8
Cluster= 8, text= Boys Apparel Topwear Tshirts Yellow Summer Year2012 Casual mr
men boys blaze yellow shirt
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
<IPython.core.display.HTML object>
    \end{Verbatim}

    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_62_66.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_62_67.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
cluster= 9
Cluster= 9, text= Men Apparel Bottomwear Track Pants Black Summer Year2010
Sports puma men wind black track pant
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
<IPython.core.display.HTML object>
    \end{Verbatim}

    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_62_70.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_62_71.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]

\end{Verbatim}
\end{tcolorbox}


    % Add a bibliography block to the postdoc
    
    
    
\end{document}
